# agro_gpt_complete.py
import random
import re
import json
import logging
from typing import List, Dict, Any, Optional
from datetime import datetime, timedelta
from enum import Enum
import asyncio
from dataclasses import dataclass
import sqlite3
import os
from http.server import HTTPServer, BaseHTTPRequestHandler
import urllib.parse as urlparse
from concurrent.futures import ThreadPoolExecutor

# –ù–∞—Å—Ç—Ä–æ–π–∫–∞ –ª–æ–≥–∏—Ä–æ–≤–∞–Ω–∏—è
logging.basicConfig(
    level=logging.INFO,
    format='%(asctime)s - %(name)s - %(levelname)s - %(message)s',
    handlers=[
        logging.FileHandler('agro_gpt.log', encoding='utf-8'),
        logging.StreamHandler()
    ]
)
logger = logging.getLogger(__name__)

class Intent(Enum):
    PLANT_CARE = "plant_care"
    DISEASE_HELP = "disease_help" 
    SOIL_ADVICE = "soil_advice"
    WATERING = "watering"
    FERTILIZER = "fertilizer"
    PEST_CONTROL = "pest_control"
    HARVEST_TIPS = "harvest_tips"
    PLANTING = "planting"
    PRUNING = "pruning"
    STORAGE = "storage"
    COMPANION_PLANTING = "companion_planting"
    WEATHER = "weather"
    GENERAL = "general"
    KYRGYZSTAN_SPECIFIC = "kyrgyzstan_specific"

@dataclass
class UserEntity:
    crops: List[str]
    symptoms: List[str]
    season: Optional[str]
    location: Optional[str]
    soil_type: Optional[str]

class AgroDatabase:
    def __init__(self, db_path: str = "agro_gpt.db"):
        self.db_path = db_path
        self._init_database()
    
    def _init_database(self):
        """–ò–Ω–∏—Ü–∏–∞–ª–∏–∑–∞—Ü–∏—è –±–∞–∑—ã –¥–∞–Ω–Ω—ã—Ö"""
        try:
            with sqlite3.connect(self.db_path) as conn:
                conn.execute('''
                    CREATE TABLE IF NOT EXISTS sessions (
                        session_id TEXT PRIMARY KEY,
                        started_at TIMESTAMP DEFAULT CURRENT_TIMESTAMP,
                        context_data TEXT
                    )
                ''')
                
                conn.execute('''
                    CREATE TABLE IF NOT EXISTS messages (
                        message_id INTEGER PRIMARY KEY AUTOINCREMENT,
                        session_id TEXT,
                        user_message TEXT,
                        bot_response TEXT,
                        intent TEXT,
                        entities TEXT,
                        timestamp TIMESTAMP DEFAULT CURRENT_TIMESTAMP,
                        FOREIGN KEY (session_id) REFERENCES sessions (session_id)
                    )
                ''')
                
                conn.commit()
                logger.info("–ë–∞–∑–∞ –¥–∞–Ω–Ω—ã—Ö –∏–Ω–∏—Ü–∏–∞–ª–∏–∑–∏—Ä–æ–≤–∞–Ω–∞ —É—Å–ø–µ—à–Ω–æ")
        except Exception as e:
            logger.error(f"–û—à–∏–±–∫–∞ –∏–Ω–∏—Ü–∏–∞–ª–∏–∑–∞—Ü–∏–∏ –±–∞–∑—ã –¥–∞–Ω–Ω—ã—Ö: {e}")
    
    def save_message(self, session_id: str, user_message: str, bot_response: str, 
                    intent: str, entities: Dict):
        """–°–æ—Ö—Ä–∞–Ω–µ–Ω–∏–µ —Å–æ–æ–±—â–µ–Ω–∏—è –≤ –±–∞–∑—É –¥–∞–Ω–Ω—ã—Ö"""
        try:
            safe_entities = self._make_json_safe(entities)
            
            with sqlite3.connect(self.db_path) as conn:
                conn.execute('''
                    INSERT OR IGNORE INTO sessions (session_id) VALUES (?)
                ''', (session_id,))
                
                conn.execute('''
                    INSERT INTO messages (session_id, user_message, bot_response, intent, entities)
                    VALUES (?, ?, ?, ?, ?)
                ''', (session_id, user_message, bot_response, intent, json.dumps(safe_entities, ensure_ascii=False)))
                conn.commit()
                logger.info(f"–°–æ–æ–±—â–µ–Ω–∏–µ —Å–æ—Ö—Ä–∞–Ω–µ–Ω–æ –¥–ª—è —Å–µ—Å—Å–∏–∏ {session_id}")
        except Exception as e:
            logger.error(f"–û—à–∏–±–∫–∞ —Å–æ—Ö—Ä–∞–Ω–µ–Ω–∏—è –≤ –±–∞–∑—É –¥–∞–Ω–Ω—ã—Ö: {e}")
    
    def _make_json_safe(self, obj):
        """–†–µ–∫—É—Ä—Å–∏–≤–Ω–æ –ø—Ä–µ–æ–±—Ä–∞–∑—É–µ—Ç –æ–±—ä–µ–∫—Ç—ã –≤ JSON-–±–µ–∑–æ–ø–∞—Å–Ω—ã–µ"""
        if isinstance(obj, dict):
            return {k: self._make_json_safe(v) for k, v in obj.items()}
        elif isinstance(obj, list):
            return [self._make_json_safe(item) for item in obj]
        elif isinstance(obj, (datetime, timedelta)):
            return str(obj)
        else:
            return obj

class AdvancedAgroKnowledgeBase:
    def __init__(self):
        self.crop_data = {
            '—Ç–æ–º–∞—Ç': {
                'watering': "–ö–∞–ø–µ–ª—å–Ω—ã–π –ø–æ–ª–∏–≤ 2-3 –ª/—Ä–∞—Å—Ç–µ–Ω–∏–µ –≤ –¥–µ–Ω—å. –£—Ç—Ä–æ–º, –ø–æ–¥ –∫–æ—Ä–µ–Ω—å. –í –ß—É–π—Å–∫–æ–π –æ–±–ª–∞—Å—Ç–∏ –ø–æ–ª–∏–≤ –≤–µ—á–µ—Ä–æ–º –∏–∑-–∑–∞ –∂–∞—Ä—ã.",
                'fertilizer': "–ü—Ä–∏ –ø–æ—Å–∞–¥–∫–µ: –ø–µ—Ä–µ–≥–Ω–æ–π. –¶–≤–µ—Ç–µ–Ω–∏–µ: –∫–∞–ª–∏–π–Ω—ã–µ. –ü–ª–æ–¥–æ–Ω–æ—à–µ–Ω–∏–µ: —Ñ–æ—Å—Ñ–æ—Ä–Ω–æ-–∫–∞–ª–∏–π–Ω—ã–µ. –ú–µ—Å—Ç–Ω—ã–µ —É–¥–æ–±—Ä–µ–Ω–∏—è: –∫—É—Ä–∏–Ω—ã–π –ø–æ–º–µ—Ç —Å —Ñ–µ—Ä–º –¢–æ–∫–º–∞–∫–∞.",
                'pests': "–ë–µ–ª–æ–∫—Ä—ã–ª–∫–∞: –∂–µ–ª—Ç—ã–µ –ª–æ–≤—É—à–∫–∏. –¢–ª—è: –º—ã–ª—å–Ω—ã–π —Ä–∞—Å—Ç–≤–æ—Ä. –ö–æ–ª–æ—Ä–∞–¥—Å–∫–∏–π –∂—É–∫: —Ä—É—á–Ω–æ–π —Å–±–æ—Ä. –í –ò—Å—Å—ã–∫-–ö—É–ª—å—Å–∫–æ–π –æ–±–ª–∞—Å—Ç–∏ - –º–µ–Ω—å—à–µ –≤—Ä–µ–¥–∏—Ç–µ–ª–µ–π.",
                'diseases': "–§–∏—Ç–æ—Ñ—Ç–æ—Ä–æ–∑: –º–µ–¥—å—Å–æ–¥–µ—Ä–∂–∞—â–∏–µ –ø—Ä–µ–ø–∞—Ä–∞—Ç—ã. –í–µ—Ä—à–∏–Ω–Ω–∞—è –≥–Ω–∏–ª—å: –∫–∞–ª—å—Ü–∏–µ–≤–∞—è —Å–µ–ª–∏—Ç—Ä–∞. –í –û—à—Å–∫–æ–π –æ–±–ª–∞—Å—Ç–∏ - —É—Å—Ç–æ–π—á–∏–≤—ã–µ —Å–æ—Ä—Ç–∞ '–û—à—Å–∫–∏–π —Ä–∞–Ω–Ω–∏–π'.",
                'harvest': "–°–±–æ—Ä —Ä–æ–∑–æ–≤—ã—Ö –ø–ª–æ–¥–æ–≤ –¥–ª—è –¥–æ–∑–∞—Ä–∏–≤–∞–Ω–∏—è. –•—Ä–∞–Ω–µ–Ω–∏–µ –ø—Ä–∏ 12-15¬∞C. –ù–∞ —Ä—ã–Ω–∫–∞—Ö –ë–∏—à–∫–µ–∫–∞ –ø—Ä–µ–¥–ø–æ—á–∏—Ç–∞—é—Ç —Å—Ä–µ–¥–Ω–∏–µ –ø–ª–æ–¥—ã.",
                'planting': "–†–∞—Å—Å–∞–¥–∞ 55-60 –¥–Ω–µ–π. –ì–ª—É–±–∏–Ω–∞ –¥–æ –ø–µ—Ä–≤—ã—Ö –ª–∏—Å—Ç—å–µ–≤. –†–∞—Å—Å—Ç–æ—è–Ω–∏–µ 40√ó60 —Å–º. –í –ß—É–π—Å–∫–æ–π –¥–æ–ª–∏–Ω–µ - —Å 15 –∞–ø—Ä–µ–ª—è.",
                'pruning': "–ü–∞—Å—ã–Ω–∫–æ–≤–∞–Ω–∏–µ —Ä–µ–≥—É–ª—è—Ä–Ω–æ–µ. –§–æ—Ä–º–∏—Ä–æ–≤–∞–Ω–∏–µ –≤ 1-2 —Å—Ç–µ–±–ª—è.",
                'storage': "–¢–µ–º–ø–µ—Ä–∞—Ç—É—Ä–∞ 10-12¬∞C, –≤–ª–∞–∂–Ω–æ—Å—Ç—å 85-90%. –ë–µ–∑ –ø–æ–≤—Ä–µ–∂–¥–µ–Ω–∏–π.",
                'kyrgyzstan_specific': "üåÑ –î–ª—è –ö—ã—Ä–≥—ã–∑—Å—Ç–∞–Ω–∞: –°–æ—Ä—Ç–∞ '–ê–ª–∞-–¢–æ–æ', '–ò—Å—Å—ã–∫-–ö—É–ª—å—Å–∫–∏–π' —Ö–æ—Ä–æ—à–æ —Ä–∞—Å—Ç—É—Ç –≤ –≤—ã—Å–æ–∫–æ–≥–æ—Ä—å–µ. –í –ù–∞—Ä—ã–Ω—Å–∫–æ–π –æ–±–ª–∞—Å—Ç–∏ –∏—Å–ø–æ–ª—å–∑—É–π—Ç–µ —Ç–µ–ø–ª–∏—Ü—ã. –†—ã–Ω–∫–∏: –î–æ—Ä–¥–æ–π (–ë–∏—à–∫–µ–∫), –ö–∞—Ä–∞-–°—É—É (–û—à)"
            },
            '–æ–≥—É—Ä–µ—Ü': {
                'watering': "–¢–µ–ø–ª–æ–π –≤–æ–¥–æ–π 22-25¬∞C, —É—Ç—Ä–æ–º. –í–ª–∞–∂–Ω–æ—Å—Ç—å –ø–æ—á–≤—ã 80%. –í –î–∂–∞–ª–∞–ª-–ê–±–∞–¥—Å–∫–æ–π –æ–±–ª–∞—Å—Ç–∏ - –ø–æ–ª–∏–≤ –∏–∑ –∞—Ä—ã–∫–æ–≤.",
                'fertilizer': "–ù–∞—á–∞–ª–æ —Ä–æ—Å—Ç–∞: –∞–∑–æ—Ç–Ω—ã–µ. –¶–≤–µ—Ç–µ–Ω–∏–µ: —Ñ–æ—Å—Ñ–æ—Ä–Ω—ã–µ. –ü–ª–æ–¥–æ–Ω–æ—à–µ–Ω–∏–µ: –∫–∞–ª–∏–π–Ω—ã–µ. –ú–µ—Å—Ç–Ω–æ–µ: –∫–æ—Ä–æ–≤—è–∫ —Å –ø–∞—Å—Ç–±–∏—â.",
                'pests': "–ü–∞—É—Ç–∏–Ω–Ω—ã–π –∫–ª–µ—â: –ø–æ–≤—ã—à–µ–Ω–∏–µ –≤–ª–∞–∂–Ω–æ—Å—Ç–∏. –¢–ª—è: –Ω–∞—Å—Ç–æ–π —Ç–∞–±–∞–∫–∞. –í –ë–∞—Ç–∫–µ–Ω—Å–∫–æ–π –æ–±–ª–∞—Å—Ç–∏ - –º–µ–Ω—å—à–µ –ø—Ä–æ–±–ª–µ–º.",
                'diseases': "–ú—É—á–Ω–∏—Å—Ç–∞—è —Ä–æ—Å–∞: –¢–æ–ø–∞–∑. –ü–µ—Ä–æ–Ω–æ—Å–ø–æ—Ä–æ–∑: –û—Ä–¥–∞–Ω.",
                'harvest': "–ö–∞–∂–¥—ã–µ 2-3 –¥–Ω—è, —É—Ç—Ä–æ–º. –†–∞–∑–º–µ—Ä 8-12 —Å–º. –ù–∞ –±–∞–∑–∞—Ä–∞—Ö –ø—Ä–µ–¥–ø–æ—á–∏—Ç–∞—é—Ç –º–µ–ª–∫–∏–µ –æ–≥—É—Ä—Ü—ã.",
                'planting': "–¢–µ–º–ø–µ—Ä–∞—Ç—É—Ä–∞ –ø–æ—á–≤—ã 15¬∞C. –ì–ª—É–±–∏–Ω–∞ 2-3 —Å–º. –°—Ö–µ–º–∞ 30√ó70 —Å–º. –í –¢–∞–ª–∞—Å—Å–∫–æ–π –¥–æ–ª–∏–Ω–µ - —Å 1 –º–∞—è.",
                'pruning': "–û—Å–ª–µ–ø–ª–µ–Ω–∏–µ –Ω–∏–∂–Ω–∏—Ö 4-5 —É–∑–ª–æ–≤. –ü—Ä–∏—â–∏–ø–∫–∞ –±–æ–∫–æ–≤—ã—Ö –ø–æ–±–µ–≥–æ–≤.",
                'storage': "–¢–µ–º–ø–µ—Ä–∞—Ç—É—Ä–∞ 8-10¬∞C, –≤–ª–∞–∂–Ω–æ—Å—Ç—å 90-95%. 7-10 –¥–Ω–µ–π.",
                'kyrgyzstan_specific': "üå± –°–æ—Ä—Ç–∞ '–ö—ã—Ä–≥—ã–∑—Å–∫–∏–π –∫–æ—Ä–Ω–∏—à–æ–Ω', '–ß—É–π—Å–∫–∏–π'. –í –≤—ã—Å–æ–∫–æ–≥–æ—Ä—å–µ –≤—ã—Ä–∞—â–∏–≤–∞–π—Ç–µ –≤ —Ç–µ–ø–ª–∏—Ü–∞—Ö. –≠–∫—Å–ø–æ—Ä—Ç –≤ –ö–∞–∑–∞—Ö—Å—Ç–∞–Ω"
            },
            '–∫–∞—Ä—Ç–æ—Ñ–µ–ª—å': {
                'watering': "–í—Å—Ö–æ–¥—ã: —É–º–µ—Ä–µ–Ω–Ω–æ. –¶–≤–µ—Ç–µ–Ω–∏–µ: –æ–±–∏–ª—å–Ω–æ. –ö–ª—É–±–Ω–µ–æ–±—Ä–∞–∑–æ–≤–∞–Ω–∏–µ: —Ä–µ–≥—É–ª—è—Ä–Ω–æ. –í –ù–∞—Ä—ã–Ω–µ –ø–æ–ª–∏–≤ —Ä–µ–∂–µ.",
                'fertilizer': "–û—Å–µ–Ω—å—é: –æ—Ä–≥–∞–Ω–∏–∫–∞. –í–µ—Å–Ω–æ–π: –∞–∑–æ—Ç–Ω—ã–µ. –û–∫—É—á–∏–≤–∞–Ω–∏–µ: –∑–æ–ª–∞. –ú–µ—Å—Ç–Ω—ã–µ —Å–æ—Ä—Ç–∞ –º–µ–Ω–µ–µ —Ç—Ä–µ–±–æ–≤–∞—Ç–µ–ª—å–Ω—ã.",
                'pests': "–ö–æ–ª–æ—Ä–∞–¥—Å–∫–∏–π –∂—É–∫: –ü—Ä–µ—Å—Ç–∏–∂. –ü—Ä–æ–≤–æ–ª–æ—á–Ω–∏–∫: –∏–∑–≤–µ—Å—Ç–∫–æ–≤–∞–Ω–∏–µ. –í –≤—ã—Å–æ–∫–æ–≥–æ—Ä—å–µ –≤—Ä–µ–¥–∏—Ç–µ–ª–µ–π –º–µ–Ω—å—à–µ.",
                'diseases': "–§–∏—Ç–æ—Ñ—Ç–æ—Ä–æ–∑: –†–∏–¥–æ–º–∏–ª. –ü–∞—Ä—à–∞: —Å–µ–≤–æ–æ–±–æ—Ä–æ—Ç.",
                'harvest': "–ß–µ—Ä–µ–∑ 2-3 –Ω–µ–¥–µ–ª–∏ –ø–æ—Å–ª–µ —É–≤—è–¥–∞–Ω–∏—è –±–æ—Ç–≤—ã. –í–∏–ª–∞–º–∏. –í —Å–µ–Ω—Ç—è–±—Ä–µ –¥–ª—è –∑–∏–º–Ω–µ–≥–æ —Ö—Ä–∞–Ω–µ–Ω–∏—è.",
                'planting': "–ü—Ä–æ—Ä–æ—â–µ–Ω–Ω—ã–µ –∫–ª—É–±–Ω–∏. –ì–ª—É–±–∏–Ω–∞ 8-10 —Å–º. –°—Ö–µ–º–∞ 70√ó30 —Å–º. –í –≥–æ—Ä–∞—Ö - –≥—Ä–µ–±–Ω–µ–≤–∞—è –ø–æ—Å–∞–¥–∫–∞.",
                'pruning': "–£–¥–∞–ª–µ–Ω–∏–µ —Ü–≤–µ—Ç–∫–æ–≤. –°–∫–∞—à–∏–≤–∞–Ω–∏–µ –±–æ—Ç–≤—ã –ø–µ—Ä–µ–¥ —É–±–æ—Ä–∫–æ–π.",
                'storage': "–¢–µ–º–ø–µ—Ä–∞—Ç—É—Ä–∞ 2-4¬∞C, –≤–ª–∞–∂–Ω–æ—Å—Ç—å 85-90%. –¢–µ–º–Ω–æ—Ç–∞. –í –ø–æ–¥–≤–∞–ª–∞—Ö –≥–æ—Ä–Ω—ã—Ö —Å–µ–ª.",
                'kyrgyzstan_specific': "ü•î –õ—É—á—à–∏–µ —Å–æ—Ä—Ç–∞: '–ê–∫-–¢–∞—à', '–°—É—É—Å–∞–º—ã—Ä—Å–∫–∏–π'. –í—ã—Ä–∞—â–∏–≤–∞—é—Ç –¥–æ 3000 –º –Ω–∞–¥ —É—Ä–æ–≤–Ω–µ–º –º–æ—Ä—è. –û—Å–Ω–æ–≤–Ω—ã–µ —Ä–µ–≥–∏–æ–Ω—ã: –ß—É–π—Å–∫–∞—è, –ò—Å—Å—ã–∫-–ö—É–ª—å—Å–∫–∞—è –æ–±–ª–∞—Å—Ç–∏"
            },
            '–∫–∞–ø—É—Å—Ç–∞': {
                'watering': "–†–µ–≥—É–ª—è—Ä–Ω–æ, –Ω–µ –¥–æ–ø—É—Å–∫–∞—è –ø–µ—Ä–µ—Å—ã—Ö–∞–Ω–∏—è. –ü–æ—Å–ª–µ –≤—ã—Å–∞–¥–∫–∏ - –µ–∂–µ–¥–Ω–µ–≤–Ω–æ. –í –û—à–µ –ø–æ–ª–∏–≤ –∏–∑ –∫–∞–Ω–∞–ª–æ–≤.",
                'fertilizer': "–ê–∑–æ—Ç –¥–ª—è —Ä–æ—Å—Ç–∞, –∫–∞–ª–∏–π –¥–ª—è –ø–ª–æ—Ç–Ω–æ—Å—Ç–∏. –ö–∞–ª—å—Ü–∏–π. –ú–µ—Å—Ç–Ω—ã–µ: –∑–æ–ª–∞, –Ω–∞–≤–æ–∑.",
                'pests': "–ö–∞–ø—É—Å—Ç–Ω–∞—è –º—É—Ö–∞: —Å–µ—Ç–∫–∞. –¢–ª—è: –∑–æ–ª—å–Ω—ã–π –Ω–∞—Å—Ç–æ–π. –ì—É—Å–µ–Ω–∏—Ü—ã: –õ–µ–ø–∏–¥–æ—Ü–∏–¥.",
                'diseases': "–ö–∏–ª–∞: –∏–∑–≤–µ—Å—Ç–∫–æ–≤–∞–Ω–∏–µ. –ß–µ—Ä–Ω–∞—è –Ω–æ–∂–∫–∞: –¢—Ä–∏—Ö–æ–¥–µ—Ä–º–∏–Ω.",
                'harvest': "–ü—Ä–∏ –ø–ª–æ—Ç–Ω–æ–º –∫–æ—á–∞–Ω–µ, –¥–æ –∑–∞–º–æ—Ä–æ–∑–∫–æ–≤. –í –æ–∫—Ç—è–±—Ä–µ-–Ω–æ—è–±—Ä–µ.",
                'planting': "–†–∞—Å—Å–∞–¥–∞ 35-45 –¥–Ω–µ–π. –°—Ö–µ–º–∞ 50√ó50 —Å–º. –í –ß—É–π—Å–∫–æ–π –¥–æ–ª–∏–Ω–µ - —Å 20 –∞–ø—Ä–µ–ª—è.",
                'pruning': "–£–¥–∞–ª–µ–Ω–∏–µ –ø–æ–∂–µ–ª—Ç–µ–≤—à–∏—Ö –ª–∏—Å—Ç—å–µ–≤.",
                'storage': "–¢–µ–º–ø–µ—Ä–∞—Ç—É—Ä–∞ 0...+1¬∞C, –≤–ª–∞–∂–Ω–æ—Å—Ç—å 90-95%.",
                'kyrgyzstan_specific': "ü•¨ –ü–æ–ø—É–ª—è—Ä–Ω—ã–µ —Å–æ—Ä—Ç–∞: '–°–ª–∞–≤–∞', '–ë–µ–ª–æ–∫–æ—á–∞–Ω–Ω–∞—è –º–µ—Å—Ç–Ω–∞—è'. –í—ã—Ä–∞—â–∏–≤–∞—é—Ç –ø–æ –≤—Å–µ–º –æ–±–ª–∞—Å—Ç—è–º. –ó–∏–º–æ–π —Ü–µ–Ω–∞ –ø–æ–≤—ã—à–∞–µ—Ç—Å—è"
            },
            '–º–æ—Ä–∫–æ–≤—å': {
                'watering': "–†–µ–≥—É–ª—è—Ä–Ω–æ, —É–º–µ—Ä–µ–Ω–Ω–æ. –ó–∞ 2-3 –Ω–µ–¥–µ–ª–∏ –¥–æ —É–±–æ—Ä–∫–∏ - –ø—Ä–µ–∫—Ä–∞—Ç–∏—Ç—å. –í –∑–∞—Å—É—à–ª–∏–≤—ã—Ö —Ä–∞–π–æ–Ω–∞—Ö - –º—É–ª—å—á–∏—Ä–æ–≤–∞–Ω–∏–µ.",
                'fertilizer': "–ö–∞–ª–∏–π –¥–ª—è —Å–∞—Ö–∞—Ä–∏—Å—Ç–æ—Å—Ç–∏. –ò–∑–±–µ–≥–∞—Ç—å —Å–≤–µ–∂–µ–≥–æ –Ω–∞–≤–æ–∑–∞. –ó–æ–ª–∞ —É–ª—É—á—à–∞–µ—Ç –≤–∫—É—Å.",
                'pests': "–ú–æ—Ä–∫–æ–≤–Ω–∞—è –º—É—Ö–∞: —Å–º–µ—à–∞–Ω–Ω—ã–µ –ø–æ—Å–µ–≤—ã. –ü—Ä–æ–≤–æ–ª–æ—á–Ω–∏–∫: –ø–µ—Ä–µ–∫–æ–ø–∫–∞.",
                'diseases': "–ê–ª—å—Ç–µ—Ä–Ω–∞—Ä–∏–æ–∑: —Å–µ–≤–æ–æ–±–æ—Ä–æ—Ç. –§–æ–º–æ–∑: –ø—Ä–æ—Ç—Ä–∞–≤–ª–∏–≤–∞–Ω–∏–µ.",
                'harvest': "–ß–µ—Ä–µ–∑ 80-120 –¥–Ω–µ–π. –í–∏–ª–∞–º–∏, –∞–∫–∫—É—Ä–∞—Ç–Ω–æ. –í —Å–µ–Ω—Ç—è–±—Ä–µ.",
                'planting': "–ì–ª—É–±–∏–Ω–∞ 1-2 —Å–º, —Ä–∞—Å—Å—Ç–æ—è–Ω–∏–µ 3-5 —Å–º. –í –¢–∞–ª–∞—Å–µ - —Å 15 –∞–ø—Ä–µ–ª—è.",
                'pruning': "–ü—Ä–æ—Ä–µ–∂–∏–≤–∞–Ω–∏–µ 2 —Ä–∞–∑–∞: –ø—Ä–∏ 2 –∏ 4-5 –ª–∏—Å—Ç—å—è—Ö.",
                'storage': "–¢–µ–º–ø–µ—Ä–∞—Ç—É—Ä–∞ 0...+2¬∞C, –≤–ª–∞–∂–Ω–æ—Å—Ç—å 90-95%.",
                'kyrgyzstan_specific': "ü•ï –°–æ—Ä—Ç–∞ '–ù–∞–Ω—Ç—Å–∫–∞—è', '–®–∞–Ω—Ç–µ–Ω—ç'. –•–æ—Ä–æ—à–æ —Ä–∞—Å—Ç–µ—Ç –≤ –ø–µ—Å—á–∞–Ω—ã—Ö –ø–æ—á–≤–∞—Ö –ß—É–π—Å–∫–æ–π –¥–æ–ª–∏–Ω—ã. –≠–∫—Å–ø–æ—Ä—Ç –≤ –†–æ—Å—Å–∏—é"
            },
            '–∫–ª—É–±–Ω–∏–∫–∞': {
                'watering': "–ö–∞–ø–µ–ª—å–Ω–æ–µ –æ—Ä–æ—à–µ–Ω–∏–µ. –¶–≤–µ—Ç–µ–Ω–∏–µ –∏ –ø–ª–æ–¥–æ–Ω–æ—à–µ–Ω–∏–µ - —Ä–µ–≥—É–ª—è—Ä–Ω–æ. –í –ò—Å—Å—ã–∫-–ö—É–ª–µ - –æ–±–∏–ª—å–Ω—ã–π –ø–æ–ª–∏–≤.",
                'fertilizer': "–í–µ—Å–Ω–∞: –∞–∑–æ—Ç–Ω—ã–µ. –¶–≤–µ—Ç–µ–Ω–∏–µ: –∫–∞–ª–∏–π–Ω—ã–µ. –ü–æ—Å–ª–µ —Å–±–æ—Ä–∞: –∫–æ–º–ø–ª–µ–∫—Å–Ω—ã–µ.",
                'pests': "–î–æ–ª–≥–æ–Ω–æ—Å–∏–∫: –ö–∞—Ä–±–æ—Ñ–æ—Å. –ö–ª–µ—â: –∫–æ–ª–ª–æ–∏–¥–Ω–∞—è —Å–µ—Ä–∞.",
                'diseases': "–°–µ—Ä–∞—è –≥–Ω–∏–ª—å: –º—É–ª—å—á–∏—Ä–æ–≤–∞–Ω–∏–µ. –ú—É—á–Ω–∏—Å—Ç–∞—è —Ä–æ—Å–∞: –¢–æ–ø–∞–∑.",
                'harvest': "–£—Ç—Ä–æ–º, –ø–æ—Å–ª–µ —Å—Ö–æ–¥–∞ —Ä–æ—Å—ã. –° –ø–ª–æ–¥–æ–Ω–æ–∂–∫–æ–π. –°–±–æ—Ä –∫–∞–∂–¥—ã–µ 2 –¥–Ω—è.",
                'planting': "–ê–≤–≥—É—Å—Ç-—Å–µ–Ω—Ç—è–±—Ä—å. –°–µ—Ä–¥–µ—á–∫–æ –Ω–∞ —É—Ä–æ–≤–Ω–µ –ø–æ—á–≤—ã. –í –ß—É–π—Å–∫–æ–π –æ–±–ª–∞—Å—Ç–∏ - —Å 25 –∞–≤–≥—É—Å—Ç–∞.",
                'pruning': "–£–¥–∞–ª–µ–Ω–∏–µ —É—Å–æ–≤ –≤ –ø–µ—Ä–≤—ã–π –≥–æ–¥. –ü–æ—Å–ª–µ —Å–±–æ—Ä–∞ - —Å–∫–∞—à–∏–≤–∞–Ω–∏–µ.",
                'storage': "–¢–µ–º–ø–µ—Ä–∞—Ç—É—Ä–∞ 0...+2¬∞C, –Ω–µ–º—ã—Ç—ã–µ. 3-5 –¥–Ω–µ–π.",
                'kyrgyzstan_specific': "üçì –ò—Å—Å—ã–∫-–ö—É–ª—å—Å–∫–∞—è –æ–±–ª–∞—Å—Ç—å - –ª–∏–¥–µ—Ä –ø–æ –≤—ã—Ä–∞—â–∏–≤–∞–Ω–∏—é. –°–æ—Ä—Ç–∞ '–ó–∞—Ä—è', '–§–µ—Å—Ç–∏–≤–∞–ª—å–Ω–∞—è'. –Ø–≥–æ–¥—ã —Å–ª–∞—â–µ –∏–∑-–∑–∞ –≤—ã—Å–æ–∫–æ–≥–æ—Ä–Ω–æ–≥–æ —Å–æ–ª–Ω—Ü–∞"
            },
            '—è–±–ª–æ–Ω—è': {
                'watering': "–ú–æ–ª–æ–¥—ã–µ –¥–µ—Ä–µ–≤—å—è: 2-3 —Ä–∞–∑–∞ –≤ –Ω–µ–¥–µ–ª—é. –í–∑—Ä–æ—Å–ª—ã–µ: 1-2 —Ä–∞–∑–∞ –≤ –º–µ—Å—è—Ü. –í –∑–∞—Å—É—Ö—É - —á–∞—â–µ.",
                'fertilizer': "–í–µ—Å–Ω–∞: –∞–∑–æ—Ç. –õ–µ—Ç–æ: –∫–∞–ª–∏–π. –û—Å–µ–Ω—å: —Ñ–æ—Å—Ñ–æ—Ä. –û—Ä–≥–∞–Ω–∏–∫–∞ —Ä–∞–∑ –≤ 2-3 –≥–æ–¥–∞.",
                'pests': "–Ø–±–ª–æ–Ω–Ω–∞—è –ø–ª–æ–¥–æ–∂–æ—Ä–∫–∞: –ª–æ–≤—á–∏–µ –ø–æ—è—Å–∞. –¢–ª—è: –º—ã–ª—å–Ω—ã–π —Ä–∞—Å—Ç–≤–æ—Ä.",
                'diseases': "–ü–∞—Ä—à–∞: –±–æ—Ä–¥–æ—Å—Å–∫–∞—è —Å–º–µ—Å—å. –ú—É—á–Ω–∏—Å—Ç–∞—è —Ä–æ—Å–∞: —Å–µ—Ä–∞.",
                'harvest': "–° –∞–≤–≥—É—Å—Ç–∞ –ø–æ –æ–∫—Ç—è–±—Ä—å –≤ –∑–∞–≤–∏—Å–∏–º–æ—Å—Ç–∏ –æ—Ç —Å–æ—Ä—Ç–∞. –ê–∫–∫—É—Ä–∞—Ç–Ω–æ —Å –ø–ª–æ–¥–æ–Ω–æ–∂–∫–æ–π.",
                'planting': "–û—Å–µ–Ω—å—é –∑–∞ –º–µ—Å—è—Ü –¥–æ –∑–∞–º–æ—Ä–æ–∑–∫–æ–≤. –Ø–º–∞ 60√ó60 —Å–º. –†–∞—Å—Å—Ç–æ—è–Ω–∏–µ 4√ó5 –º.",
                'pruning': "–§–æ—Ä–º–∏—Ä—É—é—â–∞—è –≤–µ—Å–Ω–æ–π, —Å–∞–Ω–∏—Ç–∞—Ä–Ω–∞—è –æ—Å–µ–Ω—å—é.",
                'storage': "–¢–µ–º–ø–µ—Ä–∞—Ç—É—Ä–∞ 0...+4¬∞C, –≤–ª–∞–∂–Ω–æ—Å—Ç—å 85-90%.",
                'kyrgyzstan_specific': "üçé –ö—ã—Ä–≥—ã–∑—Å—Ç–∞–Ω - —Ä–æ–¥–∏–Ω–∞ —è–±–ª–æ–∫! –°–æ—Ä—Ç–∞ '–ê–ø–æ—Ä—Ç', '–ê–ª–º–∞-–ê—Ç–∏–Ω—Å–∫–∏–π'. –ò—Å—Å—ã–∫-–ö—É–ª—å—Å–∫–∞—è –æ–±–ª–∞—Å—Ç—å - –æ—Å–Ω–æ–≤–Ω—ã–µ —Å–∞–¥—ã. –≠–∫—Å–ø–æ—Ä—Ç –≤ –ö–∏—Ç–∞–π, –†–§"
            },
            '–≤–∏–Ω–æ–≥—Ä–∞–¥': {
                'watering': "–ú–æ–ª–æ–¥—ã–µ –ª–æ–∑—ã: —Ä–µ–≥—É–ª—è—Ä–Ω–æ. –í–∑—Ä–æ—Å–ª—ã–µ: 3-4 —Ä–∞–∑–∞ –∑–∞ —Å–µ–∑–æ–Ω. –í –ë–∞—Ç–∫–µ–Ω–µ - –∫–∞–ø–µ–ª—å–Ω–æ–µ –æ—Ä–æ—à–µ–Ω–∏–µ.",
                'fertilizer': "–í–µ—Å–Ω–∞: –∞–∑–æ—Ç. –¶–≤–µ—Ç–µ–Ω–∏–µ: —Ñ–æ—Å—Ñ–æ—Ä. –°–æ–∑—Ä–µ–≤–∞–Ω–∏–µ: –∫–∞–ª–∏–π.",
                'pests': "–§–∏–ª–ª–æ–∫—Å–µ—Ä–∞: —É—Å—Ç–æ–π—á–∏–≤—ã–µ –ø–æ–¥–≤–æ–∏. –ö–ª–µ—â–∏: —Å–µ—Ä–∞.",
                'diseases': "–ú–∏–ª–¥—å—é: –º–µ–¥—å—Å–æ–¥–µ—Ä–∂–∞—â–∏–µ. –û–∏–¥–∏—É–º: —Å–µ—Ä–∞.",
                'harvest': "–ü—Ä–∏ –ø–æ–ª–Ω–æ–π –∑—Ä–µ–ª–æ—Å—Ç–∏, —É—Ç—Ä–æ–º. –í –∞–≤–≥—É—Å—Ç–µ-—Å–µ–Ω—Ç—è–±—Ä–µ.",
                'planting': "–í–µ—Å–Ω–æ–π –ø–æ—Å–ª–µ –∑–∞–º–æ—Ä–æ–∑–∫–æ–≤. –ì–ª—É–±–∏–Ω–∞ 40-50 —Å–º. –†–∞—Å—Å—Ç–æ—è–Ω–∏–µ 1.5√ó2 –º.",
                'pruning': "–û—Å–µ–Ω–Ω—è—è –æ–±—Ä–µ–∑–∫–∞ –ø–æ—Å–ª–µ –ª–∏—Å—Ç–æ–ø–∞–¥–∞. –§–æ—Ä–º–∏—Ä–æ–≤–∫–∞ –ø–æ —Å–∏—Å—Ç–µ–º–µ.",
                'storage': "–¢–µ–º–ø–µ—Ä–∞—Ç—É—Ä–∞ 0...+2¬∞C, –≤–ª–∞–∂–Ω–æ—Å—Ç—å 90-95%.",
                'kyrgyzstan_specific': "üçá –û—Å–Ω–æ–≤–Ω—ã–µ —Ä–µ–≥–∏–æ–Ω—ã: –ë–∞—Ç–∫–µ–Ω—Å–∫–∞—è, –û—à—Å–∫–∞—è –æ–±–ª–∞—Å—Ç–∏. –°–æ—Ä—Ç–∞ '–†–∫–∞—Ü–∏—Ç–µ–ª–∏', '–ë–∞—è–Ω —à–∏—Ä–µ–π'. –ü—Ä–æ–∏–∑–≤–æ–¥—Å—Ç–≤–æ –≤–∏–Ω–∞ —Ä–∞–∑–≤–∏–≤–∞–µ—Ç—Å—è"
            },
            '–ø—à–µ–Ω–∏—Ü–∞': {
                'watering': "–û–∑–∏–º–∞—è –ø—à–µ–Ω–∏—Ü–∞: –ø–æ–ª–∏–≤ –æ—Å–µ–Ω—å—é –∏ –≤–µ—Å–Ω–æ–π. –Ø—Ä–æ–≤–∞—è: 3-4 –ø–æ–ª–∏–≤–∞ –∑–∞ —Å–µ–∑–æ–Ω. –ù–æ—Ä–º–∞: 600-800 –º¬≥/–≥–∞. –í –ß—É–π—Å–∫–æ–π –æ–±–ª–∞—Å—Ç–∏ - –æ—Ä–æ—à–µ–Ω–∏–µ –∏–∑ –∫–∞–Ω–∞–ª–æ–≤.",
                'fertilizer': "–û—Å–µ–Ω—å—é: —Ñ–æ—Å—Ñ–æ—Ä–Ω–æ-–∫–∞–ª–∏–π–Ω—ã–µ. –í–µ—Å–Ω–æ–π: –∞–∑–æ—Ç–Ω—ã–µ –ø–æ–¥–∫–æ—Ä–º–∫–∏. –ù–æ—Ä–º–∞ N60-90 P60 K40.",
                'pests': "–ö–ª–æ–ø-—á–µ—Ä–µ–ø–∞—à–∫–∞, –ø—à–µ–Ω–∏—á–Ω—ã–π —Ç—Ä–∏–ø—Å, —Ç–ª—è. –û–±—Ä–∞–±–æ—Ç–∫–∞ –∏–Ω—Å–µ–∫—Ç–∏—Ü–∏–¥–∞–º–∏ –≤ —Ñ–∞–∑—É –∫—É—â–µ–Ω–∏—è.",
                'diseases': "–ú—É—á–Ω–∏—Å—Ç–∞—è —Ä–æ—Å–∞, —Ä–∂–∞–≤—á–∏–Ω–∞, —Å–µ–ø—Ç–æ—Ä–∏–æ–∑. –ü—Ä–æ—Ç—Ä–∞–≤–ª–∏–≤–∞–Ω–∏–µ —Å–µ–º—è–Ω, —Ñ—É–Ω–≥–∏—Ü–∏–¥—ã.",
                'harvest': "–§–∞–∑–∞ –≤–æ—Å–∫–æ–≤–æ–π —Å–ø–µ–ª–æ—Å—Ç–∏, –≤–ª–∞–∂–Ω–æ—Å—Ç—å –∑–µ—Ä–Ω–∞ 14-17%. –ü—Ä—è–º–æ–µ –∫–æ–º–±–∞–π–Ω–∏—Ä–æ–≤–∞–Ω–∏–µ.",
                'planting': "–û–∑–∏–º–∞—è: —Å–µ–Ω—Ç—è–±—Ä—å-–æ–∫—Ç—è–±—Ä—å. –Ø—Ä–æ–≤–∞—è: –º–∞—Ä—Ç-–∞–ø—Ä–µ–ª—å. –ù–æ—Ä–º–∞ –≤—ã—Å–µ–≤–∞ 4-5 –º–ª–Ω/–≥–∞.",
                'pruning': "–ù–µ —Ç—Ä–µ–±—É–µ—Ç—Å—è –¥–ª—è –∑–µ—Ä–Ω–æ–≤—ã—Ö –∫—É–ª—å—Ç—É—Ä.",
                'storage': "–í–ª–∞–∂–Ω–æ—Å—Ç—å –¥–æ 14%, —Ç–µ–º–ø–µ—Ä–∞—Ç—É—Ä–∞ –¥–æ +15¬∞C. –í–µ–Ω—Ç–∏–ª–∏—Ä—É–µ–º—ã–µ —Å–∫–ª–∞–¥—ã.",
                'kyrgyzstan_specific': "üåæ –û—Å–Ω–æ–≤–Ω—ã–µ —Ä–µ–≥–∏–æ–Ω—ã: –ß—É–π—Å–∫–∞—è, –¢–∞–ª–∞—Å—Å–∫–∞—è –æ–±–ª–∞—Å—Ç–∏. –°–æ—Ä—Ç–∞: '–ö—ã—Ä–≥—ã–∑—Å–∫–∞—è 95', '–ê–∫-–ë–∞—Å'. –£—Ä–æ–∂–∞–π–Ω–æ—Å—Ç—å: 25-40 —Ü/–≥–∞"
            },
            '–ª—É–∫': {
                'watering': "–ü–æ–ª–∏–≤ 1-2 —Ä–∞–∑–∞ –≤ –Ω–µ–¥–µ–ª—é, –≤ –∑–∞—Å—É—Ö—É - —á–∞—â–µ. –ó–∞ 2-3 –Ω–µ–¥–µ–ª–∏ –¥–æ —É–±–æ—Ä–∫–∏ –ø—Ä–µ–∫—Ä–∞—Ç–∏—Ç—å –ø–æ–ª–∏–≤. –ù–æ—Ä–º–∞: 300-400 –º¬≥/–≥–∞.",
                'fertilizer': "–û—Å–µ–Ω—å—é: –æ—Ä–≥–∞–Ω–∏–∫–∞ + —Ñ–æ—Å—Ñ–æ—Ä–Ω–æ-–∫–∞–ª–∏–π–Ω—ã–µ. –í–µ—Å–Ω–æ–π: –∞–∑–æ—Ç–Ω—ã–µ –ø–æ–¥–∫–æ—Ä–º–∫–∏. –ù–æ—Ä–º–∞: N45 P60 K60.",
                'pests': "–õ—É–∫–æ–≤–∞—è –º—É—Ö–∞: —Ç–∞–±–∞—á–Ω–∞—è –ø—ã–ª—å, –∑–æ–ª–∞. –¢—Ä–∏–ø—Å—ã: –∏–Ω—Å–µ–∫—Ç–∏—Ü–∏–¥—ã.",
                'diseases': "–ü–µ—Ä–æ–Ω–æ—Å–ø–æ—Ä–æ–∑: –º–µ–¥—å—Å–æ–¥–µ—Ä–∂–∞—â–∏–µ –ø—Ä–µ–ø–∞—Ä–∞—Ç—ã. –®–µ–π–∫–æ–≤–∞—è –≥–Ω–∏–ª—å: –ø—Ä–∞–≤–∏–ª—å–Ω–æ–µ —Ö—Ä–∞–Ω–µ–Ω–∏–µ.",
                'harvest': "–ü—Ä–∏ –ø–æ–ª–µ–≥–∞–Ω–∏–∏ –ø–µ—Ä–∞, –≤ —Å—É—Ö—É—é –ø–æ–≥–æ–¥—É. –õ—É–∫–æ–≤–∏—Ü—ã –ø—Ä–æ—Å—É—à–∏—Ç—å 7-10 –¥–Ω–µ–π.",
                'planting': "–°–µ–≤–æ–∫: –∞–ø—Ä–µ–ª—å-–º–∞–π. –°–µ–º–µ–Ω–∞: –º–∞—Ä—Ç-–∞–ø—Ä–µ–ª—å. –ì–ª—É–±–∏–Ω–∞ 2-3 —Å–º, —Ä–∞—Å—Å—Ç–æ—è–Ω–∏–µ 10√ó25 —Å–º.",
                'pruning': "–ù–µ —Ç—Ä–µ–±—É–µ—Ç—Å—è. –£–¥–∞–ª–µ–Ω–∏–µ —Ü–≤–µ—Ç–æ—á–Ω—ã—Ö —Å—Ç—Ä–µ–ª–æ–∫ —É —Ä–µ–ø—á–∞—Ç–æ–≥–æ –ª—É–∫–∞.",
                'storage': "–¢–µ–º–ø–µ—Ä–∞—Ç—É—Ä–∞ 0...+1¬∞C, –≤–ª–∞–∂–Ω–æ—Å—Ç—å 70-75%. –í –∫–æ—Å–∞—Ö –∏–ª–∏ —è—â–∏–∫–∞—Ö.",
                'kyrgyzstan_specific': "üßÖ –ü–æ–ø—É–ª—è—Ä–Ω—ã–µ —Å–æ—Ä—Ç–∞: '–°—Ç—Ä–∏–≥—É–Ω–æ–≤—Å–∫–∏–π', '–Ø–ª—Ç–∏–Ω—Å–∫–∏–π'. –•–æ—Ä–æ—à–æ —Ä–∞—Å—Ç–µ—Ç –≤ –ß—É–π—Å–∫–æ–π –∏ –û—à—Å–∫–æ–π –æ–±–ª–∞—Å—Ç—è—Ö. –ò—Å–ø–æ–ª—å–∑—É–µ—Ç—Å—è –≤ –Ω–∞—Ü–∏–æ–Ω–∞–ª—å–Ω–æ–π –∫—É—Ö–Ω–µ"
            },
            '–∞–±—Ä–∏–∫–æ—Å': {
                'watering': "–ú–æ–ª–æ–¥—ã–µ –¥–µ—Ä–µ–≤—å—è: 2-3 —Ä–∞–∑–∞ –≤ –Ω–µ–¥–µ–ª—é. –í–∑—Ä–æ—Å–ª—ã–µ: 3-4 —Ä–∞–∑–∞ –∑–∞ —Å–µ–∑–æ–Ω, –æ—Å–æ–±–µ–Ω–Ω–æ –≤ —Ñ–∞–∑—É –Ω–∞–ª–∏–≤–∞ –ø–ª–æ–¥–æ–≤.",
                'fertilizer': "–í–µ—Å–Ω–∞: –∞–∑–æ—Ç–Ω—ã–µ. –õ–µ—Ç–æ: –∫–∞–ª–∏–π–Ω—ã–µ. –û—Å–µ–Ω—å: —Ñ–æ—Å—Ñ–æ—Ä–Ω—ã–µ. –û—Ä–≥–∞–Ω–∏–∫–∞ —Ä–∞–∑ –≤ 3-4 –≥–æ–¥–∞.",
                'pests': "–ü–ª–æ–¥–æ–∂–æ—Ä–∫–∞: –ª–æ–≤—á–∏–µ –ø–æ—è—Å–∞. –¢–ª—è: –º—ã–ª—å–Ω—ã–π —Ä–∞—Å—Ç–≤–æ—Ä. –ö–ª–µ—â–∏: —Å–µ—Ä–∞.",
                'diseases': "–ú–æ–Ω–∏–ª–∏–æ–∑: –±–æ—Ä–¥–æ—Å—Å–∫–∞—è —Å–º–µ—Å—å. –ö–ª—è—Å—Ç–µ—Ä–æ—Å–ø–æ—Ä–∏–æ–∑: –º–µ–¥—å—Å–æ–¥–µ—Ä–∂–∞—â–∏–µ –ø—Ä–µ–ø–∞—Ä–∞—Ç—ã.",
                'harvest': "–í —Ñ–∞–∑–µ —Ç–µ—Ö–Ω–∏—á–µ—Å–∫–æ–π —Å–ø–µ–ª–æ—Å—Ç–∏, –∞–∫–∫—É—Ä–∞—Ç–Ω–æ —Å –ø–ª–æ–¥–æ–Ω–æ–∂–∫–æ–π. –ò—é–ª—å-–∞–≤–≥—É—Å—Ç.",
                'planting': "–û—Å–µ–Ω—å—é –∑–∞ –º–µ—Å—è—Ü –¥–æ –∑–∞–º–æ—Ä–æ–∑–∫–æ–≤. –Ø–º–∞ 80√ó80 —Å–º. –†–∞—Å—Å—Ç–æ—è–Ω–∏–µ 5√ó6 –º.",
                'pruning': "–§–æ—Ä–º–∏—Ä—É—é—â–∞—è –≤–µ—Å–Ω–æ–π, –æ–º–æ–ª–∞–∂–∏–≤–∞—é—â–∞—è –∫–∞–∂–¥—ã–µ 4-5 –ª–µ—Ç.",
                'storage': "–¢–µ–º–ø–µ—Ä–∞—Ç—É—Ä–∞ 0...+2¬∞C, –≤–ª–∞–∂–Ω–æ—Å—Ç—å 85-90%. 2-3 –Ω–µ–¥–µ–ª–∏.",
                'kyrgyzstan_specific': "üçë –õ—É—á—à–∏–µ —Ä–µ–≥–∏–æ–Ω—ã: –û—à—Å–∫–∞—è, –î–∂–∞–ª–∞–ª-–ê–±–∞–¥—Å–∫–∞—è –æ–±–ª–∞—Å—Ç–∏. –°–æ—Ä—Ç–∞: '–ö—ã—Ä–≥—ã–∑—Å–∫–∏–π –ª—É—á—à–∏–π', '–°—É–ø–µ—Ä–∏–æ—Ä'. –ò–¥–µ—Ç –Ω–∞ —Å—É—à–∫—É (—É—Ä—é–∫) –∏ —ç–∫—Å–ø–æ—Ä—Ç"
            }
        }
        
        self.kyrgyzstan_regions = {
            '—á—É–π—Å–∫–∞—è': {
                'climate': "–£–º–µ—Ä–µ–Ω–Ω–æ-–∫–æ–Ω—Ç–∏–Ω–µ–Ω—Ç–∞–ª—å–Ω—ã–π, –∂–∞—Ä–∫–æ–µ –ª–µ—Ç–æ +25-35¬∞C, —Ö–æ–ª–æ–¥–Ω–∞—è –∑–∏–º–∞ -15-25¬∞C",
                'soil': "–°–µ—Ä–æ–∑–µ–º—ã, —Ç–µ–º–Ω–æ-–∫–∞—à—Ç–∞–Ω–æ–≤—ã–µ, –Ω—É–∂–¥–∞—é—Ç—Å—è –≤ –æ—Ä–≥–∞–Ω–∏–∫–µ",
                'specialization': "–û–≤–æ—â–∏, —Ñ—Ä—É–∫—Ç—ã, –ø—à–µ–Ω–∏—Ü–∞, –∫—É–∫—É—Ä—É–∑–∞",
                'water': "–†–µ–∫–∏ –ß—É, –ê–ª–∞-–ê—Ä—á–∞, –æ—Ä–æ—Å–∏—Ç–µ–ª—å–Ω—ã–µ —Å–∏—Å—Ç–µ–º—ã",
                'markets': "–ë–∏—à–∫–µ–∫, –î–æ—Ä–¥–æ–π, –ö–∞—Ä–∞-–ë–∞–ª—Ç–∞",
                'soil_details': "üå± **–ü–æ—á–≤—ã –ß—É–π—Å–∫–æ–π –æ–±–ª–∞—Å—Ç–∏:**\n‚Ä¢ –°–µ—Ä–æ–∑–µ–º—ã - —Ç—Ä–µ–±—É—é—Ç —Ä–µ–≥—É–ª—è—Ä–Ω–æ–≥–æ –≤–Ω–µ—Å–µ–Ω–∏—è –æ—Ä–≥–∞–Ω–∏–∫–∏\n‚Ä¢ –¢–µ–º–Ω–æ-–∫–∞—à—Ç–∞–Ω–æ–≤—ã–µ - —É–º–µ—Ä–µ–Ω–Ω–æ –ø–ª–æ–¥–æ—Ä–æ–¥–Ω—ã–µ\n‚Ä¢ –ù—É–∂–¥–∞—é—Ç—Å—è –≤ –∏–∑–≤–µ—Å—Ç–∫–æ–≤–∞–Ω–∏–∏ –∫–∞–∂–¥—ã–µ 3-4 –≥–æ–¥–∞\n‚Ä¢ –†–µ–∫–æ–º–µ–Ω–¥—É–µ—Ç—Å—è —Å–∏–¥–µ—Ä–∞—Ü–∏—è –∏ –º—É–ª—å—á–∏—Ä–æ–≤–∞–Ω–∏–µ"
            },
            '–∏—Å—Å—ã–∫-–∫—É–ª—å—Å–∫–∞—è': {
                'climate': "–£–º–µ—Ä–µ–Ω–Ω—ã–π –º–æ—Ä—Å–∫–æ–π, –ª–µ—Ç–æ +20-28¬∞C, –∑–∏–º–∞ -5-15¬∞C",
                'soil': "–ö–∞—à—Ç–∞–Ω–æ–≤—ã–µ, –≥–æ—Ä–Ω–æ-–ª—É–≥–æ–≤—ã–µ, –ø–ª–æ–¥–æ—Ä–æ–¥–Ω—ã–µ",
                'specialization': "–Ø–±–ª–æ–∫–∏, –≥—Ä—É—à–∏, –∫–ª—É–±–Ω–∏–∫–∞, –∫–∞—Ä—Ç–æ—Ñ–µ–ª—å",
                'water': "–û–∑–µ—Ä–æ –ò—Å—Å—ã–∫-–ö—É–ª—å, —Ä–µ–∫–∏, —Ä–æ–¥–Ω–∏–∫–∏",
                'markets': "–ß–æ–ª–ø–æ–Ω-–ê—Ç–∞, –ö–∞—Ä–∞–∫–æ–ª, –ë–∞–ª—ã–∫—á—ã",
                'soil_details': "üå± **–ü–æ—á–≤—ã –ò—Å—Å—ã–∫-–ö—É–ª—å—Å–∫–æ–π –æ–±–ª–∞—Å—Ç–∏:**\n‚Ä¢ –ö–∞—à—Ç–∞–Ω–æ–≤—ã–µ - –≤—ã—Å–æ–∫–æ–ø–ª–æ–¥–æ—Ä–æ–¥–Ω—ã–µ\n‚Ä¢ –ì–æ—Ä–Ω–æ-–ª—É–≥–æ–≤—ã–µ - –±–æ–≥–∞—Ç—ã –æ—Ä–≥–∞–Ω–∏–∫–æ–π\n‚Ä¢ –•–æ—Ä–æ—à–æ –¥–µ—Ä–∂–∞—Ç –≤–ª–∞–≥—É\n‚Ä¢ –ü–æ–¥—Ö–æ–¥—è—Ç –¥–ª—è —Å–∞–¥–æ–≤–æ–¥—Å—Ç–≤–∞ –±–µ–∑ –¥–æ–ø–æ–ª–Ω–∏—Ç–µ–ª—å–Ω–æ–≥–æ —É–¥–æ–±—Ä–µ–Ω–∏—è"
            },
            '–æ—à—Å–∫–∞—è': {
                'climate': "–†–µ–∑–∫–æ-–∫–æ–Ω—Ç–∏–Ω–µ–Ω—Ç–∞–ª—å–Ω—ã–π, –∂–∞—Ä–∫–æ–µ –ª–µ—Ç–æ +30-40¬∞C, –º—è–≥–∫–∞—è –∑–∏–º–∞ -5-10¬∞C",
                'soil': "–°–µ—Ä–æ–∑–µ–º—ã, –Ω—É–∂–¥–∞—é—Ç—Å—è –≤ –æ—Ä–æ—à–µ–Ω–∏–∏",
                'specialization': "–•–ª–æ–ø–æ–∫, —Ç–∞–±–∞–∫, —Ñ—Ä—É–∫—Ç—ã, –æ–≤–æ—â–∏",
                'water': "–†–µ–∫–∏ –ê–∫-–ë—É—Ä–∞, –æ—Ä–æ—Å–∏—Ç–µ–ª—å–Ω—ã–µ –∫–∞–Ω–∞–ª—ã",
                'markets': "–û—à, –ö–∞—Ä–∞-–°—É—É, –£–∑–≥–µ–Ω",
                'soil_details': "üå± **–ü–æ—á–≤—ã –û—à—Å–∫–æ–π –æ–±–ª–∞—Å—Ç–∏:**\n‚Ä¢ –°–µ—Ä–æ–∑–µ–º—ã - —Ç—Ä–µ–±—É—é—Ç –æ—Ä–æ—à–µ–Ω–∏—è\n‚Ä¢ –°–∫–ª–æ–Ω–Ω—ã –∫ –∑–∞—Å–æ–ª–µ–Ω–∏—é\n‚Ä¢ –ù—É–∂–¥–∞—é—Ç—Å—è –≤ –≥–∏–ø—Å–æ–≤–∞–Ω–∏–∏\n‚Ä¢ –†–µ–∫–æ–º–µ–Ω–¥—É–µ—Ç—Å—è –∫–∞–ø–µ–ª—å–Ω–æ–µ –æ—Ä–æ—à–µ–Ω–∏–µ"
            },
            '–¥–∂–∞–ª–∞–ª-–∞–±–∞–¥—Å–∫–∞—è': {
                'climate': "–£–º–µ—Ä–µ–Ω–Ω—ã–π, –ª–µ—Ç–æ +25-35¬∞C, –∑–∏–º–∞ -5-15¬∞C",
                'soil': "–°–µ—Ä–æ–∑–µ–º—ã, –∞–ª–ª—é–≤–∏–∞–ª—å–Ω—ã–µ, –ø–ª–æ–¥–æ—Ä–æ–¥–Ω—ã–µ",
                'specialization': "–û—Ä–µ—Ö–∏, —Ñ—Ä—É–∫—Ç—ã, —Ö–ª–æ–ø–æ–∫, —Ç–∞–±–∞–∫",
                'water': "–†–µ–∫–∏ –ö–∞—Ä–∞-–î–∞—Ä—ã—è, –æ—Ä–æ—Å–∏—Ç–µ–ª—å–Ω—ã–µ —Å–∏—Å—Ç–µ–º—ã",
                'markets': "–î–∂–∞–ª–∞–ª-–ê–±–∞–¥, –ú–∞–π–ª—É—É-–°—É—É, –ö–æ–∫-–ñ–∞–Ω–≥–∞–∫",
                'soil_details': "üå± **–ü–æ—á–≤—ã –î–∂–∞–ª–∞–ª-–ê–±–∞–¥—Å–∫–æ–π –æ–±–ª–∞—Å—Ç–∏:**\n‚Ä¢ –ê–ª–ª—é–≤–∏–∞–ª—å–Ω—ã–µ - –æ—á–µ–Ω—å –ø–ª–æ–¥–æ—Ä–æ–¥–Ω—ã–µ\n‚Ä¢ –ü–æ–¥—Ö–æ–¥—è—Ç –¥–ª—è –æ—Ä–µ—Ö–æ–≤—ã—Ö —Å–∞–¥–æ–≤\n‚Ä¢ –¢—Ä–µ–±—É—é—Ç –º–∏–Ω–∏–º–∞–ª—å–Ω–æ–π –æ–±—Ä–∞–±–æ—Ç–∫–∏\n‚Ä¢ –ë–æ–≥–∞—Ç—ã –º–∏–∫—Ä–æ—ç–ª–µ–º–µ–Ω—Ç–∞–º–∏"
            },
            '–Ω–∞—Ä—ã–Ω—Å–∫–∞—è': {
                'climate': "–†–µ–∑–∫–æ-–∫–æ–Ω—Ç–∏–Ω–µ–Ω—Ç–∞–ª—å–Ω—ã–π, –ø—Ä–æ—Ö–ª–∞–¥–Ω–æ–µ –ª–µ—Ç–æ +15-25¬∞C, —Ö–æ–ª–æ–¥–Ω–∞—è –∑–∏–º–∞ -20-35¬∞C",
                'soil': "–ì–æ—Ä–Ω–æ-—Å—Ç–µ–ø–Ω—ã–µ, –Ω—É–∂–¥–∞—é—Ç—Å—è –≤ —É–¥–æ–±—Ä–µ–Ω–∏—è—Ö",
                'specialization': "–ñ–∏–≤–æ—Ç–Ω–æ–≤–æ–¥—Å—Ç–≤–æ, –∫–∞—Ä—Ç–æ—Ñ–µ–ª—å, —è—á–º–µ–Ω—å",
                'water': "–†–µ–∫–∞ –ù–∞—Ä—ã–Ω, —Ä–æ–¥–Ω–∏–∫–∏",
                'markets': "–ù–∞—Ä—ã–Ω, –ê—Ç-–ë–∞—à—ã, –ö–æ—á–∫–æ—Ä",
                'soil_details': "üå± **–ü–æ—á–≤—ã –ù–∞—Ä—ã–Ω—Å–∫–æ–π –æ–±–ª–∞—Å—Ç–∏:**\n‚Ä¢ –ì–æ—Ä–Ω–æ-—Å—Ç–µ–ø–Ω—ã–µ - –±–µ–¥–Ω—ã–µ –æ—Ä–≥–∞–Ω–∏–∫–æ–π\n‚Ä¢ –¢—Ä–µ–±—É—é—Ç –∏–Ω—Ç–µ–Ω—Å–∏–≤–Ω–æ–≥–æ —É–¥–æ–±—Ä–µ–Ω–∏—è\n‚Ä¢ –ö–∏—Å–ª—ã–µ, –Ω—É–∂–¥–∞—é—Ç—Å—è –≤ –∏–∑–≤–µ—Å—Ç–∫–æ–≤–∞–Ω–∏–∏\n‚Ä¢ –ü–æ–¥—Ö–æ–¥—è—Ç –¥–ª—è –∫–∞—Ä—Ç–æ—Ñ–µ–ª—è –∏ –∑–µ—Ä–Ω–æ–≤—ã—Ö"
            },
            '—Ç–∞–ª–∞—Å—Å–∫–∞—è': {
                'climate': "–£–º–µ—Ä–µ–Ω–Ω—ã–π, –ª–µ—Ç–æ +20-30¬∞C, –∑–∏–º–∞ -10-20¬∞C",
                'soil': "–¢–µ–º–Ω–æ-–∫–∞—à—Ç–∞–Ω–æ–≤—ã–µ, –ø–ª–æ–¥–æ—Ä–æ–¥–Ω—ã–µ",
                'specialization': "–ü—à–µ–Ω–∏—Ü–∞, —è—á–º–µ–Ω—å, –æ–≤–æ—â–∏, —Ñ—Ä—É–∫—Ç—ã",
                'water': "–†–µ–∫–∞ –¢–∞–ª–∞—Å, –æ—Ä–æ—Å–∏—Ç–µ–ª—å–Ω—ã–µ –∫–∞–Ω–∞–ª—ã",
                'markets': "–¢–∞–ª–∞—Å, –ö–∞—Ä–∞-–ë—É—É—Ä–∞, –ú–∞–Ω–∞—Å",
                'soil_details': "üå± **–ü–æ—á–≤—ã –¢–∞–ª–∞—Å—Å–∫–æ–π –æ–±–ª–∞—Å—Ç–∏:**\n‚Ä¢ –¢–µ–º–Ω–æ-–∫–∞—à—Ç–∞–Ω–æ–≤—ã–µ - –≤—ã—Å–æ–∫–æ–ø–ª–æ–¥–æ—Ä–æ–¥–Ω—ã–µ\n‚Ä¢ –ò–¥–µ–∞–ª—å–Ω—ã –¥–ª—è –∑–µ—Ä–Ω–æ–≤—ã—Ö –∫—É–ª—å—Ç—É—Ä\n‚Ä¢ –•–æ—Ä–æ—à–æ –¥–µ—Ä–∂–∞—Ç –≤–ª–∞–≥—É\n‚Ä¢ –¢—Ä–µ–±—É—é—Ç —Å–µ–≤–æ–æ–±–æ—Ä–æ—Ç–∞"
            },
            '–±–∞—Ç–∫–µ–Ω—Å–∫–∞—è': {
                'climate': "–†–µ–∑–∫–æ-–∫–æ–Ω—Ç–∏–Ω–µ–Ω—Ç–∞–ª—å–Ω—ã–π, –∂–∞—Ä–∫–æ–µ –ª–µ—Ç–æ +25-35¬∞C, –º—è–≥–∫–∞—è –∑–∏–º–∞ -5-10¬∞C",
                'soil': "–°–µ—Ä–æ–∑–µ–º—ã, –Ω—É–∂–¥–∞—é—Ç—Å—è –≤ –æ—Ä–æ—à–µ–Ω–∏–∏",
                'specialization': "–í–∏–Ω–æ–≥—Ä–∞–¥, —Ñ—Ä—É–∫—Ç—ã, —Ö–ª–æ–ø–æ–∫",
                'water': "–†–µ–∫–∏, –∞—Ä—ã–∫–∏, –∫–∞–ø–µ–ª—å–Ω–æ–µ –æ—Ä–æ—à–µ–Ω–∏–µ",
                'markets': "–ë–∞—Ç–∫–µ–Ω, –ò—Å—Ñ–∞–Ω–∞, –ö—ã–∑—ã–ª-–ö–∏—è",
                'soil_details': "üå± **–ü–æ—á–≤—ã –ë–∞—Ç–∫–µ–Ω—Å–∫–æ–π –æ–±–ª–∞—Å—Ç–∏:**\n‚Ä¢ –°–µ—Ä–æ–∑–µ–º—ã - —Ç—Ä–µ–±—É—é—Ç –æ—Ä–æ—à–µ–Ω–∏—è\n‚Ä¢ –ü–æ–¥—Ö–æ–¥—è—Ç –¥–ª—è –≤–∏–Ω–æ–≥—Ä–∞–¥–∞—Ä—Å—Ç–≤–∞\n‚Ä¢ –ù—É–∂–¥–∞—é—Ç—Å—è –≤ –æ—Ä–≥–∞–Ω–∏—á–µ—Å–∫–∏—Ö —É–¥–æ–±—Ä–µ–Ω–∏—è—Ö\n‚Ä¢ –•–æ—Ä–æ—à–∏ –¥–ª—è —Å—É–±—Ç—Ä–æ–ø–∏—á–µ—Å–∫–∏—Ö –∫—É–ª—å—Ç—É—Ä"
            }
        }
        
        self.general_advice = {
            'pest_control': {
                '—Ç–ª—è': "–ú—ã–ª—å–Ω—ã–π —Ä–∞—Å—Ç–≤–æ—Ä, –Ω–∞—Å—Ç–æ–π —Ç–∞–±–∞–∫–∞, –±–æ–∂—å–∏ –∫–æ—Ä–æ–≤–∫–∏. –í –ö—ã—Ä–≥—ã–∑—Å—Ç–∞–Ω–µ —ç—Ñ—Ñ–µ–∫—Ç–∏–≤–µ–Ω –Ω–∞—Å—Ç–æ–π —á–∏—Å—Ç–æ—Ç–µ–ª–∞",
                '–∫–ª–µ—â': "–ü–æ–≤—ã—à–µ–Ω–∏–µ –≤–ª–∞–∂–Ω–æ—Å—Ç–∏, –∞–∫–∞—Ä–∏—Ü–∏–¥—ã. –í –∂–∞—Ä–∫–∏—Ö —Ä–µ–≥–∏–æ–Ω–∞—Ö - —É—Ç—Ä–µ–Ω–Ω–µ–µ –æ–ø—Ä—ã—Å–∫–∏–≤–∞–Ω–∏–µ",
                '–≥—É—Å–µ–Ω–∏—Ü—ã': "–†—É—á–Ω–æ–π —Å–±–æ—Ä, –ë–∏—Ç–æ–∫—Å–∏–±–∞—Ü–∏–ª–ª–∏–Ω. –í –≥–æ—Ä–∞—Ö - –º–µ–Ω—å—à–µ –ø—Ä–æ–±–ª–µ–º",
                '—Å–ª–∏–∑–Ω–∏': "–õ–æ–≤—É—à–∫–∏, –∑–æ–ª–∞, —Å—É–ø–µ—Ä—Ñ–æ—Å—Ñ–∞—Ç. –í –¥–æ–∂–¥–ª–∏–≤—ã—Ö —Ä–∞–π–æ–Ω–∞—Ö - –¥—Ä–µ–Ω–∞–∂",
                '–º—É—Ö–∏': "–°–µ—Ç–∫–∏, —Ç–∞–±–∞—á–Ω–∞—è –ø—ã–ª—å, –Ω–∞—Å—Ç–æ–π –ø–æ–ª—ã–Ω–∏. –ú–µ—Å—Ç–Ω–æ–µ —Å—Ä–µ–¥—Å—Ç–≤–æ - –∑–æ–ª–∞ —Å —Ç–∞–±–∞–∫–æ–º",
                '–∫–æ–ª–æ—Ä–∞–¥—Å–∫–∏–π –∂—É–∫': "–†—É—á–Ω–æ–π —Å–±–æ—Ä, –ü—Ä–µ—Å—Ç–∏–∂, –†–µ–≥–µ–Ω—Ç. –í –≤—ã—Å–æ–∫–æ–≥–æ—Ä—å–µ - —Ä–µ–∂–µ –ø–æ—è–≤–ª—è–µ—Ç—Å—è"
            },
            'disease_control': {
                '–≥—Ä–∏–±–∫–æ–≤—ã–µ': "–ú–µ–¥—å—Å–æ–¥–µ—Ä–∂–∞—â–∏–µ –ø—Ä–µ–ø–∞—Ä–∞—Ç—ã, —Å–µ—Ä–∞, –ø—Ä–æ–≤–µ—Ç—Ä–∏–≤–∞–Ω–∏–µ. –í –¥–æ–ª–∏–Ω–∞—Ö - –ø—Ä–æ—Ñ–∏–ª–∞–∫—Ç–∏–∫–∞",
                '–±–∞–∫—Ç–µ—Ä–∏–∞–ª—å–Ω—ã–µ': "–§–∏—Ç–æ–ª–∞–≤–∏–Ω, —Å–µ–≤–æ–æ–±–æ—Ä–æ—Ç. –ò—Å–ø–æ–ª—å–∑–æ–≤–∞—Ç—å –º–µ—Å—Ç–Ω—ã–µ —É—Å—Ç–æ–π—á–∏–≤—ã–µ —Å–æ—Ä—Ç–∞",
                '–≤–∏—Ä—É—Å–Ω—ã–µ': "–£–¥–∞–ª–µ–Ω–∏–µ —Å –∫–æ—Ä–Ω–µ–º, —É—Å—Ç–æ–π—á–∏–≤—ã–µ —Å–æ—Ä—Ç–∞. –ü–æ–∫—É–ø–∞—Ç—å —Å–µ—Ä—Ç–∏—Ñ–∏—Ü–∏—Ä–æ–≤–∞–Ω–Ω—ã–µ —Å–µ–º–µ–Ω–∞",
                '–≥–Ω–∏–ª–∏': "–°–Ω–∏–∂–µ–Ω–∏–µ –≤–ª–∞–∂–Ω–æ—Å—Ç–∏, –∫–∞–ª—å—Ü–∏–π. –í –≥–æ—Ä–∞—Ö - —Ö–æ—Ä–æ—à–µ–µ –ø—Ä–æ–≤–µ—Ç—Ä–∏–≤–∞–Ω–∏–µ"
            },
            'soil_improvement': {
                '–≥–ª–∏–Ω–∏—Å—Ç–∞—è': "–ü–µ—Å–æ–∫, –∫–æ–º–ø–æ—Å—Ç, —Å–∏–¥–µ—Ä–∞—Ç—ã. –í –ö—ã—Ä–≥—ã–∑—Å—Ç–∞–Ω–µ - –¥–æ–±–∞–≤–ª–µ–Ω–∏–µ —Ä–µ—á–Ω–æ–≥–æ –ø–µ—Å–∫–∞",
                '–ø–µ—Å—á–∞–Ω–∞—è': "–ì–ª–∏–Ω–∞, –æ—Ä–≥–∞–Ω–∏–∫–∞, —Ç–æ—Ä—Ñ. –ò—Å–ø–æ–ª—å–∑–æ–≤–∞—Ç—å –º–µ—Å—Ç–Ω—ã–π –Ω–∞–≤–æ–∑",
                '–∫–∏—Å–ª–∞—è': "–ò–∑–≤–µ—Å—Ç—å, –¥–æ–ª–æ–º–∏—Ç–æ–≤–∞—è –º—É–∫–∞, –∑–æ–ª–∞. –í –≥–æ—Ä–∞—Ö - –∏–∑–≤–µ—Å—Ç–∫–æ–≤–∞–Ω–∏–µ –æ–±—è–∑–∞—Ç–µ–ª—å–Ω–æ",
                '—â–µ–ª–æ—á–Ω–∞—è': "–¢–æ—Ä—Ñ, —Å–µ—Ä–∞, —Ö–≤–æ–π–Ω—ã–π –æ–ø–∞–¥. –í –¥–æ–ª–∏–Ω–∞—Ö - –≥–∏–ø—Å–æ–≤–∞–Ω–∏–µ"
            },
            'companion_planting': {
                '—Ç–æ–º–∞—Ç': "–ë–∞–∑–∏–ª–∏–∫, –±–∞—Ä—Ö–∞—Ç—Ü—ã, –ª—É–∫. –í –ö—ã—Ä–≥—ã–∑—Å—Ç–∞–Ω–µ - —Å –º—è—Ç–æ–π –∏ –∫–∏–Ω–∑–æ–π",
                '–æ–≥—É—Ä–µ—Ü': "–£–∫—Ä–æ–ø, –∫—É–∫—É—Ä—É–∑–∞, –±–æ–±—ã. –ú–µ—Å—Ç–Ω–∞—è –ø—Ä–∞–∫—Ç–∏–∫–∞ - —Å –ø–æ–¥—Å–æ–ª–Ω—É—Ö–æ–º",
                '–∫–∞—Ä—Ç–æ—Ñ–µ–ª—å': "–ë–æ–±—ã, —Ö—Ä–µ–Ω, –∫–æ—Ä–∏–∞–Ω–¥—Ä. –í —Å–µ–ª–∞—Ö - —Å —Ñ–∞—Å–æ–ª—å—é",
                '–∫–∞–ø—É—Å—Ç–∞': "–°–µ–ª—å–¥–µ—Ä–µ–π, —É–∫—Ä–æ–ø, –º—è—Ç–∞. –¢—Ä–∞–¥–∏—Ü–∏–æ–Ω–Ω–æ - —Å —Å–≤–µ–∫–ª–æ–π",
                '–º–æ—Ä–∫–æ–≤—å': "–õ—É–∫, –≥–æ—Ä–æ—Ö, —à–∞–ª—Ñ–µ–π. –ù–∞—Ä–æ–¥–Ω—ã–π –º–µ—Ç–æ–¥ - —Å —Ä–µ–¥–∏—Å–æ–º"
            },
            'kyrgyzstan_specific': {
                '–≥–æ—Å–ø–æ–¥–¥–µ—Ä–∂–∫–∞': """üá∞üá¨ **–ì–æ—Å–ø—Ä–æ–≥—Ä–∞–º–º—ã –ø–æ–¥–¥–µ—Ä–∂–∫–∏ —Ñ–µ—Ä–º–µ—Ä–æ–≤:**

üèõÔ∏è **–ú–∏–Ω—Å–µ–ª—å—Ö–æ–∑ –ö–†:**
‚Ä¢ –õ—å–≥–æ—Ç–Ω—ã–µ –∫—Ä–µ–¥–∏—Ç—ã –ø–æ–¥ 5-7% –≥–æ–¥–æ–≤—ã—Ö
‚Ä¢ –°—É–±—Å–∏–¥–∏–∏ –Ω–∞ –ø–æ–∫—É–ø–∫—É —Å–µ–º—è–Ω –∏ —É–¥–æ–±—Ä–µ–Ω–∏–π - –¥–æ 50% —Å—Ç–æ–∏–º–æ—Å—Ç–∏
‚Ä¢ –ö–æ–º–ø–µ–Ω—Å–∞—Ü–∏—è –∑–∞—Ç—Ä–∞—Ç –Ω–∞ —Ç–µ—Ö–Ω–∏–∫—É - –¥–æ 30%

üåæ **–ü—Ä–æ–≥—Ä–∞–º–º—ã —Ä–∞–∑–≤–∏—Ç–∏—è:**
‚Ä¢ "–ó–µ–ª–µ–Ω—ã–π —Ñ–æ–Ω–¥" - –æ–∑–µ–ª–µ–Ω–µ–Ω–∏–µ –∏ —Å–∞–¥–æ–≤–æ–¥—Å—Ç–≤–æ
‚Ä¢ "–ê–≥—Ä–æ—ç–∫—Å–ø–æ—Ä—Ç" - –ø–æ–¥–¥–µ—Ä–∂–∫–∞ —ç–∫—Å–ø–æ—Ä—Ç–µ—Ä–æ–≤
‚Ä¢ "–°–µ–ª—å—Å–∫–∏–π —Ç—É—Ä–∏–∑–º" - —Ä–∞–∑–≤–∏—Ç–∏–µ –∞–≥—Ä–æ—Ç—É—Ä–∏–∑–º–∞

üíº **–î–ª—è –ø–æ–ª—É—á–µ–Ω–∏—è –ø–æ–¥–¥–µ—Ä–∂–∫–∏:**
1. –û–±—Ä–∞—Ç–∏—Ç—å—Å—è –≤ —Ä–∞–π–æ–Ω–Ω—ã–π –æ—Ç–¥–µ–ª —Å–µ–ª—å—Å–∫–æ–≥–æ —Ö–æ–∑—è–π—Å—Ç–≤–∞
2. –ü—Ä–µ–¥—Å—Ç–∞–≤–∏—Ç—å –±–∏–∑–Ω–µ—Å-–ø–ª–∞–Ω
3. –ò–º–µ—Ç—å —Å—Ç–∞–∂ —Ñ–µ—Ä–º–µ—Ä—Å–∫–æ–π –¥–µ—è—Ç–µ–ª—å–Ω–æ—Å—Ç–∏ –æ—Ç 2 –ª–µ—Ç
4. –ü—Ä–µ–¥–æ—Å—Ç–∞–≤–∏—Ç—å –∑–∞–ª–æ–≥ –∏–º—É—â–µ—Å—Ç–≤–∞""",

                '—ç–∫—Å–ø–æ—Ä—Ç': """üá∞üá¨ **–≠–∫—Å–ø–æ—Ä—Ç —Å–µ–ª—å—Ö–æ–∑–ø—Ä–æ–¥—É–∫—Ü–∏–∏:**

üåç **–û—Å–Ω–æ–≤–Ω—ã–µ –Ω–∞–ø—Ä–∞–≤–ª–µ–Ω–∏—è:**
‚Ä¢ –ö–∞–∑–∞—Ö—Å—Ç–∞–Ω: —è–±–ª–æ–∫–∏, –∫–∞—Ä—Ç–æ—Ñ–µ–ª—å, –æ–≤–æ—â–∏ (–æ–±—ä–µ–º: 15-20 —Ç—ã—Å. —Ç–æ–Ω–Ω/–≥–æ–¥)
‚Ä¢ –†–æ—Å—Å–∏—è: —Å—É—Ö–æ—Ñ—Ä—É–∫—Ç—ã, –æ—Ä–µ—Ö–∏, –º—ë–¥ (–æ–±—ä–µ–º: 8-12 —Ç—ã—Å. —Ç–æ–Ω–Ω/–≥–æ–¥) 
‚Ä¢ –ö–∏—Ç–∞–π: —ç–∫–æ–ª–æ–≥–∏—á–µ—Å–∫–∏ —á–∏—Å—Ç—ã–µ –ø—Ä–æ–¥—É–∫—Ç—ã (—Ä–∞—Å—Ç—É—â–∏–π —Ä—ã–Ω–æ–∫)

üìã **–¢—Ä–µ–±–æ–≤–∞–Ω–∏—è:**
‚Ä¢ –§–∏—Ç–æ—Å–∞–Ω–∏—Ç–∞—Ä–Ω—ã–π —Å–µ—Ä—Ç–∏—Ñ–∏–∫–∞—Ç
‚Ä¢ –°–µ—Ä—Ç–∏—Ñ–∏–∫–∞—Ç —Å–æ–æ—Ç–≤–µ—Ç—Å—Ç–≤–∏—è
‚Ä¢ –†–∞–∑—Ä–µ—à–µ–Ω–∏–µ —Ç–∞–º–æ–∂–µ–Ω–Ω–æ–π —Å–ª—É–∂–±—ã
‚Ä¢ –£–ø–∞–∫–æ–≤–∫–∞ –ø–æ –º–µ–∂–¥—É–Ω–∞—Ä–æ–¥–Ω—ã–º —Å—Ç–∞–Ω–¥–∞—Ä—Ç–∞–º

üöÄ **–ü–µ—Ä—Å–ø–µ–∫—Ç–∏–≤–Ω—ã–µ –Ω–∏—à–∏:**
‚Ä¢ –û—Ä–≥–∞–Ω–∏—á–µ—Å–∫–∏–µ –ø—Ä–æ–¥—É–∫—Ç—ã
‚Ä¢ –ì–æ—Ä–Ω—ã–µ —è–≥–æ–¥—ã –∏ —Ç—Ä–∞–≤—ã
‚Ä¢ –°—É—Ö–æ—Ñ—Ä—É–∫—Ç—ã (—É—Ä—é–∫, –∫—É—Ä–∞–≥–∞)
‚Ä¢ –ú–µ–¥ –≤—ã—Å–æ–∫–æ–≥–æ—Ä–Ω—ã–π""",

                '–ø–µ—Ä–µ—Ä–∞–±–æ—Ç–∫–∞': "–ü–µ—Ä–µ—Ä–∞–±–æ—Ç–∫–∞: —Å—É—Ö–æ—Ñ—Ä—É–∫—Ç—ã, –≤–∞—Ä–µ–Ω—å—è, —Å–æ–∫–∏. –í–æ–∑–º–æ–∂–Ω–æ—Å—Ç–∏ –¥–ª—è –º–∞–ª–æ–≥–æ –±–∏–∑–Ω–µ—Å–∞",
                '–∏—Ä—Ä–∏–≥–∞—Ü–∏—è': "–ò—Ä—Ä–∏–≥–∞—Ü–∏—è: —Ç—Ä–∞–¥–∏—Ü–∏–æ–Ω–Ω–∞—è –∞—Ä—ã—á–Ω–∞—è —Å–∏—Å—Ç–µ–º–∞, —Å–æ–≤—Ä–µ–º–µ–Ω–Ω–æ–µ –∫–∞–ø–µ–ª—å–Ω–æ–µ –æ—Ä–æ—à–µ–Ω–∏–µ",
                '—Å–µ–º–µ–Ω–∞': "–°–µ–º–µ–Ω–æ–≤–æ–¥—Å—Ç–≤–æ: –º–µ—Å—Ç–Ω—ã–µ —Å–æ—Ä—Ç–∞ –∞–¥–∞–ø—Ç–∏—Ä–æ–≤–∞–Ω—ã –∫ –≥–æ—Ä–Ω—ã–º —É—Å–ª–æ–≤–∏—è–º",
                
                '–ø–æ–¥–¥–µ—Ä–∂–∫–∞_—ç–∫—Å–ø–æ—Ä—Ç–µ—Ä–æ–≤': """üá∞üá¨ **–ü–æ–¥–¥–µ—Ä–∂–∫–∞ —ç–∫—Å–ø–æ—Ä—Ç—ë—Ä–æ–≤:**

üí∞ **–§–∏–Ω–∞–Ω—Å–æ–≤–∞—è –ø–æ–¥–¥–µ—Ä–∂–∫–∞:**
‚Ä¢ –ö–æ–º–ø–µ–Ω—Å–∞—Ü–∏—è —Ç—Ä–∞–Ω—Å–ø–æ—Ä—Ç–Ω—ã—Ö —Ä–∞—Å—Ö–æ–¥–æ–≤ - –¥–æ 50%
‚Ä¢ –í–æ–∑–º–µ—â–µ–Ω–∏–µ –∑–∞—Ç—Ä–∞—Ç –Ω–∞ —Å–µ—Ä—Ç–∏—Ñ–∏–∫–∞—Ü–∏—é - –¥–æ 70%
‚Ä¢ –õ—å–≥–æ—Ç–Ω–æ–µ –∫—Ä–µ–¥–∏—Ç–æ–≤–∞–Ω–∏–µ —ç–∫—Å–ø–æ—Ä—Ç–Ω—ã—Ö –æ–ø–µ—Ä–∞—Ü–∏–π

üåê **–ò–Ω—Ñ—Ä–∞—Å—Ç—Ä—É–∫—Ç—É—Ä–Ω–∞—è –ø–æ–¥–¥–µ—Ä–∂–∫–∞:**
‚Ä¢ –£—á–∞—Å—Ç–∏–µ –≤ –º–µ–∂–¥—É–Ω–∞—Ä–æ–¥–Ω—ã—Ö –≤—ã—Å—Ç–∞–≤–∫–∞—Ö
‚Ä¢ –û—Ä–≥–∞–Ω–∏–∑–∞—Ü–∏—è –±–∏–∑–Ω–µ—Å-–º–∏—Å—Å–∏–π
‚Ä¢ –ö–æ–Ω—Å—É–ª—å—Ç–∞—Ü–∏–∏ –ø–æ —Ç—Ä–µ–±–æ–≤–∞–Ω–∏—è–º —Å—Ç—Ä–∞–Ω-–∏–º–ø–æ—Ä—Ç–µ—Ä–æ–≤

üìä **–ò–Ω—Ñ–æ—Ä–º–∞—Ü–∏–æ–Ω–Ω–∞—è –ø–æ–¥–¥–µ—Ä–∂–∫–∞:**
‚Ä¢ –ë–∞–∑–∞ –¥–∞–Ω–Ω—ã—Ö –ø–æ—Ç–µ–Ω—Ü–∏–∞–ª—å–Ω—ã—Ö –ø–æ–∫—É–ø–∞—Ç–µ–ª–µ–π
‚Ä¢ –ê–Ω–∞–ª–∏—Ç–∏–∫–∞ —Ä—ã–Ω–∫–æ–≤ —Å–±—ã—Ç–∞
‚Ä¢ –Æ—Ä–∏–¥–∏—á–µ—Å–∫–æ–µ —Å–æ–ø—Ä–æ–≤–æ–∂–¥–µ–Ω–∏–µ —Å–¥–µ–ª–æ–∫

üîó **–ö–æ–Ω—Ç–∞–∫—Ç—ã:**
‚Ä¢ –¢–æ—Ä–≥–æ–≤–æ-–ø—Ä–æ–º—ã—à–ª–µ–Ω–Ω–∞—è –ø–∞–ª–∞—Ç–∞ –ö–†
‚Ä¢ –ú–∏–Ω–∏—Å—Ç–µ—Ä—Å—Ç–≤–æ —ç–∫–æ–Ω–æ–º–∏–∫–∏ –∏ –∫–æ–º–º–µ—Ä—Ü–∏–∏
‚Ä¢ –ê–≥–µ–Ω—Ç—Å—Ç–≤–æ –ø–æ –ø—Ä–æ–¥–≤–∏–∂–µ–Ω–∏—é —ç–∫—Å–ø–æ—Ä—Ç–∞""",
                
                '–ø—Ä–æ–≥—Ä–∞–º–º—ã_—Ä–∞–∑–≤–∏—Ç–∏—è': """üá∞üá¨ **–ü—Ä–æ–≥—Ä–∞–º–º—ã —Ä–∞–∑–≤–∏—Ç–∏—è —Å–µ–ª—å—Å–∫–∏—Ö —Ç–µ—Ä—Ä–∏—Ç–æ—Ä–∏–π:**

üèòÔ∏è **–ò–Ω—Ñ—Ä–∞—Å—Ç—Ä—É–∫—Ç—É—Ä–Ω—ã–µ –ø—Ä–æ–µ–∫—Ç—ã:**
‚Ä¢ –°—Ç—Ä–æ–∏—Ç–µ–ª—å—Å—Ç–≤–æ –∏ —Ä–µ–º–æ–Ω—Ç –¥–æ—Ä–æ–≥
‚Ä¢ –†–∞–∑–≤–∏—Ç–∏–µ —Å–∏—Å—Ç–µ–º –≤–æ–¥–æ—Å–Ω–∞–±–∂–µ–Ω–∏—è
‚Ä¢ –≠–ª–µ–∫—Ç—Ä–æ—Å–Ω–∞–±–∂–µ–Ω–∏–µ –æ—Ç–¥–∞–ª–µ–Ω–Ω—ã—Ö —Å–µ–ª

üë®‚Äçüåæ **–°–æ—Ü–∏–∞–ª—å–Ω–∞—è –ø–æ–¥–¥–µ—Ä–∂–∫–∞:**
‚Ä¢ –°—É–±—Å–∏–¥–∏–∏ –Ω–∞ –∂–∏–ª—å–µ –¥–ª—è –º–æ–ª–æ–¥—ã—Ö —Ñ–µ—Ä–º–µ—Ä–æ–≤
‚Ä¢ –û–±—Ä–∞–∑–æ–≤–∞—Ç–µ–ª—å–Ω—ã–µ –ø—Ä–æ–≥—Ä–∞–º–º—ã –ø–æ –∞–≥—Ä–æ–Ω–æ–º–∏–∏
‚Ä¢ –ú–µ–¥–∏—Ü–∏–Ω—Å–∫–æ–µ –æ–±—Å–ª—É–∂–∏–≤–∞–Ω–∏–µ –≤ —Å–µ–ª–∞—Ö

üå≥ **–≠–∫–æ–ª–æ–≥–∏—á–µ—Å–∫–∏–µ –ø—Ä–æ–≥—Ä–∞–º–º—ã:**
‚Ä¢ –í–æ—Å—Å—Ç–∞–Ω–æ–≤–ª–µ–Ω–∏–µ –ø–∞—Å—Ç–±–∏—â
‚Ä¢ –ë–æ—Ä—å–±–∞ —Å —ç—Ä–æ–∑–∏–µ–π –ø–æ—á–≤
‚Ä¢ –†–∞–∑–≤–∏—Ç–∏–µ –æ—Ä–≥–∞–Ω–∏—á–µ—Å–∫–æ–≥–æ –∑–µ–º–ª–µ–¥–µ–ª–∏—è

üìû **–î–ª—è —É—á–∞—Å—Ç–∏—è:**
–û–±—Ä–∞—â–∞—Ç—å—Å—è –≤ –∞–π—ã–ª –æ–∫–º–æ—Ç—É (—Å–µ–ª—å—Å–∫–∏–µ —É–ø—Ä–∞–≤—ã) –∏ —Ä–∞–π–æ–Ω–Ω—ã–µ –∞–¥–º–∏–Ω–∏—Å—Ç—Ä–∞—Ü–∏–∏"""
            }
        }

class AgroMLService:
    def __init__(self):
        self.disease_patterns = {
            '–≥—Ä–∏–±–∫–æ–≤—ã–µ': ['–ø—è—Ç–Ω–∞', '–Ω–∞–ª–µ—Ç', '–ø—É—à–∏—Å—Ç—ã–π', '–ø–ª–µ—Å–µ–Ω—å', '–º—É—á–Ω–∏—Å—Ç—ã–π'],
            '–±–∞–∫—Ç–µ—Ä–∏–∞–ª—å–Ω—ã–µ': ['–º–æ–∫—Ä—ã–µ –ø—è—Ç–Ω–∞', '—Å–ª–∏–∑—å', '–≥–Ω–∏–ª—å', '–º–æ–∫—Ä–∞—è'],
            '–≤–∏—Ä—É—Å–Ω—ã–µ': ['–º–æ–∑–∞–∏–∫–∞', '–¥–µ—Ñ–æ—Ä–º–∞—Ü–∏—è', '–∫–∞—Ä–ª–∏–∫–æ–≤–æ—Å—Ç—å', '—Å–∫—Ä—É—á–∏–≤–∞–Ω–∏–µ'],
            '–Ω–µ–¥–æ—Å—Ç–∞—Ç–æ–∫ –ø–∏—Ç–∞–Ω–∏—è': ['–ø–æ–∂–µ–ª—Ç–µ–Ω–∏–µ', '—Ö–ª–æ—Ä–æ–∑', '–±–ª–µ–¥–Ω–æ—Å—Ç—å', '–º–µ–ª–∫–∏–µ –ª–∏—Å—Ç—å—è']
        }
    
    def analyze_symptoms(self, symptoms: List[str]) -> Dict[str, float]:
        """–ê–Ω–∞–ª–∏–∑ —Å–∏–º–ø—Ç–æ–º–æ–≤"""
        results = {}
        total_matches = 0
        
        for disease_type, patterns in self.disease_patterns.items():
            matches = sum(1 for symptom in symptoms if any(pattern in symptom for pattern in patterns))
            if matches > 0:
                results[disease_type] = matches
                total_matches += matches
        
        if total_matches > 0:
            for key in results:
                results[key] = round(results[key] / total_matches, 2)
        
        return results

class AgroContextManager:
    def __init__(self):
        self.contexts = {}
        self.context_timeout = 3600
        self.max_context_size = 10
    
    def _cleanup_old_contexts(self):
        """–û—á–∏—Å—Ç–∫–∞ —Å—Ç–∞—Ä—ã—Ö –∫–æ–Ω—Ç–µ–∫—Å—Ç–æ–≤"""
        if len(self.contexts) > self.max_context_size:
            sorted_contexts = sorted(
                self.contexts.items(), 
                key=lambda x: x[1].get('last_activity', datetime.min)
            )
            for session_id, _ in sorted_contexts[:len(self.contexts) - self.max_context_size]:
                del self.contexts[session_id]
    
    def _ensure_string_session_id(self, session_id) -> str:
        """–ì–∞—Ä–∞–Ω—Ç–∏—Ä—É–µ–º —á—Ç–æ session_id —ç—Ç–æ —Å—Ç—Ä–æ–∫–∞"""
        if isinstance(session_id, list):
            return str(session_id[0]) if session_id else "default"
        elif session_id is None:
            return "default"
        return str(session_id)
    
    def get_context(self, session_id) -> Dict:
        """–ü–æ–ª—É—á–µ–Ω–∏–µ –∫–æ–Ω—Ç–µ–∫—Å—Ç–∞ —Å–µ—Å—Å–∏–∏"""
        session_id = self._ensure_string_session_id(session_id)
        
        if session_id in self.contexts:
            context = self.contexts[session_id]
            if isinstance(context.get('last_activity'), datetime):
                if datetime.now() - context['last_activity'] < timedelta(seconds=self.context_timeout):
                    return context
                else:
                    del self.contexts[session_id]
        
        new_context = {
            'crops': [],
            'current_problem': None,
            'conversation_stage': 'greeting',
            'user_experience': 'beginner',
            'last_intent': None,
            'message_history': [],
            'last_activity': datetime.now(),
            'session_start': datetime.now()
        }
        self.contexts[session_id] = new_context
        
        self._cleanup_old_contexts()
        
        return new_context
    
    def update_context(self, session_id, updates: Dict):
        """–û–±–Ω–æ–≤–ª–µ–Ω–∏–µ –∫–æ–Ω—Ç–µ–∫—Å—Ç–∞"""
        session_id = self._ensure_string_session_id(session_id)
        context = self.get_context(session_id)
        
        if 'message_history' not in context:
            context['message_history'] = []
        
        context.update(updates)
        context['last_activity'] = datetime.now()
        self.contexts[session_id] = context

class AgroResponseGenerator:
    def __init__(self, knowledge_base: AdvancedAgroKnowledgeBase, ml_service: AgroMLService):
        self.kb = knowledge_base
        self.ml = ml_service
        
    def generate_response(self, intent: Intent, entities: Dict, context: Dict, user_message: str = "") -> str:
        """–£–º–Ω–∞—è –≥–µ–Ω–µ—Ä–∞—Ü–∏—è –æ—Ç–≤–µ—Ç–æ–≤ –Ω–∞ –æ—Å–Ω–æ–≤–µ –∏–Ω—Ç–µ–Ω—Ç–∞ –∏ —Å—É—â–Ω–æ—Å—Ç–µ–π"""
        
        crops = entities.get('crops', [])
        symptoms = entities.get('symptoms', [])
        pests = entities.get('pests', [])
        location = entities.get('location')
        message_lower = user_message.lower()
        
        if intent == Intent.GENERAL:
            if not crops:
                # –î–µ—Ç–∞–ª—å–Ω–æ–µ –æ–ø–∏—Å–∞–Ω–∏–µ –≤–æ–∑–º–æ–∂–Ω–æ—Å—Ç–µ–π –ø—Ä–∏ –ø–µ—Ä–≤–æ–º –ø—Ä–∏–≤–µ—Ç—Å—Ç–≤–∏–∏
                if context.get('conversation_stage') == 'greeting':
                    welcome_message = """üá∞üá¨ –ê—Å—Å–∞–ª–æ–º—É –∞–ª–µ–π–∫—É–º! –Ø –≤–∞—à –∞–≥—Ä–æ–Ω–æ–º–∏—á–µ—Å–∫–∏–π –ø–æ–º–æ—â–Ω–∏–∫ –¥–ª—è –ö—ã—Ä–≥—ã–∑—Å—Ç–∞–Ω–∞! 

üå± **–ß–µ–º —è –º–æ–≥—É –≤–∞–º –ø–æ–º–æ—á—å:**

üèîÔ∏è **–ü–æ —Ä–µ–≥–∏–æ–Ω–∞–º –ö—ã—Ä–≥—ã–∑—Å—Ç–∞–Ω–∞:**
‚Ä¢ –ß—É–π—Å–∫–∞—è –æ–±–ª–∞—Å—Ç—å (–ë–∏—à–∫–µ–∫, –¢–æ–∫–º–∞–∫, –ö–∞—Ä–∞-–ë–∞–ª—Ç–∞)
‚Ä¢ –ò—Å—Å—ã–∫-–ö—É–ª—å—Å–∫–∞—è –æ–±–ª–∞—Å—Ç—å (–ö–∞—Ä–∞–∫–æ–ª, –ß–æ–ª–ø–æ–Ω-–ê—Ç–∞, –ë–∞–ª—ã–∫—á—ã) 
‚Ä¢ –û—à—Å–∫–∞—è –æ–±–ª–∞—Å—Ç—å (–û—à, –£–∑–≥–µ–Ω, –ö–∞—Ä–∞-–°—É—É)
‚Ä¢ –î–∂–∞–ª–∞–ª-–ê–±–∞–¥—Å–∫–∞—è –æ–±–ª–∞—Å—Ç—å
‚Ä¢ –ù–∞—Ä—ã–Ω—Å–∫–∞—è –æ–±–ª–∞—Å—Ç—å
‚Ä¢ –¢–∞–ª–∞—Å—Å–∫–∞—è –æ–±–ª–∞—Å—Ç—å
‚Ä¢ –ë–∞—Ç–∫–µ–Ω—Å–∫–∞—è –æ–±–ª–∞—Å—Ç—å

üåø **–ü–æ –∫—É–ª—å—Ç—É—Ä–∞–º:**
‚Ä¢ –¢–æ–º–∞—Ç—ã, –æ–≥—É—Ä—Ü—ã, –∫–∞—Ä—Ç–æ—Ñ–µ–ª—å, –∫–∞–ø—É—Å—Ç–∞
‚Ä¢ –ú–æ—Ä–∫–æ–≤—å, –ª—É–∫, –ø–µ—Ä–µ—Ü, –±–∞–∫–ª–∞–∂–∞–Ω—ã
‚Ä¢ –Ø–±–ª–æ–∫–∏, –≥—Ä—É—à–∏, –∞–±—Ä–∏–∫–æ—Å—ã, –≤–∏–Ω–æ–≥—Ä–∞–¥
‚Ä¢ –ö–ª—É–±–Ω–∏–∫–∞, –º–∞–ª–∏–Ω–∞, —Å–º–æ—Ä–æ–¥–∏–Ω–∞
‚Ä¢ –ü—à–µ–Ω–∏—Ü–∞, —è—á–º–µ–Ω—å, –∫—É–∫—É—Ä—É–∑–∞

üéØ **–ü–æ —Ç–µ–º–∞–º:**
‚Ä¢ –ü–æ–ª–∏–≤ –∏ –æ—Ä–æ—à–µ–Ω–∏–µ üíß
‚Ä¢ –£–¥–æ–±—Ä–µ–Ω–∏—è –∏ –ø–æ–¥–∫–æ—Ä–º–∫–∏ üå±
‚Ä¢ –ë–æ—Ä—å–±–∞ —Å –≤—Ä–µ–¥–∏—Ç–µ–ª—è–º–∏ üêõ
‚Ä¢ –õ–µ—á–µ–Ω–∏–µ –±–æ–ª–µ–∑–Ω–µ–π üè•
‚Ä¢ –ü–æ—Å–∞–¥–∫–∞ –∏ —É—Ö–æ–¥ üåø
‚Ä¢ –°–±–æ—Ä –∏ —Ö—Ä–∞–Ω–µ–Ω–∏–µ —É—Ä–æ–∂–∞—è üì¶
‚Ä¢ –°–æ–≤–º–µ—Å—Ç–∏–º–æ—Å—Ç—å —Ä–∞—Å—Ç–µ–Ω–∏–π üå∏

üíº **–ë–∏–∑–Ω–µ—Å –∏ –ø–æ–¥–¥–µ—Ä–∂–∫–∞:**
‚Ä¢ –ì–æ—Å–ø—Ä–æ–≥—Ä–∞–º–º—ã –¥–ª—è —Ñ–µ—Ä–º–µ—Ä–æ–≤
‚Ä¢ –≠–∫—Å–ø–æ—Ä—Ç –≤ –ö–∞–∑–∞—Ö—Å—Ç–∞–Ω, –†–æ—Å—Å–∏—é, –ö–∏—Ç–∞–π
‚Ä¢ –†—ã–Ω–∫–∏ —Å–±—ã—Ç–∞ –≤ –ö—ã—Ä–≥—ã–∑—Å—Ç–∞–Ω–µ
‚Ä¢ –ú–µ—Å—Ç–Ω—ã–µ —Å–æ—Ä—Ç–∞ —Ä–∞—Å—Ç–µ–Ω–∏–π

**–ü—Ä–∏–º–µ—Ä—ã –∑–∞–ø—Ä–æ—Å–æ–≤:**
"–∫–∞–∫–∏–µ —Å–æ—Ä—Ç–∞ —Ç–æ–º–∞—Ç–æ–≤ –¥–ª—è –ß—É–π—Å–∫–æ–π –æ–±–ª–∞—Å—Ç–∏"
"–±–æ—Ä—å–±–∞ —Å –≤—Ä–µ–¥–∏—Ç–µ–ª—è–º–∏ –∫–∞–ø—É—Å—Ç—ã" 
"–≥–æ—Å–ø–æ–¥–¥–µ—Ä–∂–∫–∞ —Ñ–µ—Ä–º–µ—Ä–æ–≤"
"—ç–∫—Å–ø–æ—Ä—Ç —è–±–ª–æ–∫ –≤ –ö–∞–∑–∞—Ö—Å—Ç–∞–Ω"
"–ø–æ—á–≤—ã –ù–∞—Ä—ã–Ω—Å–∫–æ–π –æ–±–ª–∞—Å—Ç–∏"

–°–ø—Ä–∞—à–∏–≤–∞–π—Ç–µ - –ø–æ–º–æ–≥—É —Å –≤–∞—à–∏–º –≤–æ–ø—Ä–æ—Å–æ–º! üòä"""

                    # –û–±–Ω–æ–≤–ª—è–µ–º –∫–æ–Ω—Ç–µ–∫—Å—Ç —á—Ç–æ–±—ã –±–æ–ª—å—à–µ –Ω–µ –ø–æ–∫–∞–∑—ã–≤–∞—Ç—å –ø–æ–ª–Ω–æ–µ –æ–ø–∏—Å–∞–Ω–∏–µ
                    context['conversation_stage'] = 'active'
                    return welcome_message
                else:
                    greetings = [
                        "–°–∞–ª–∞–º–∞—Ç—Å—ã–∑–±—ã! –ß–µ–º –º–æ–≥—É –ø–æ–º–æ—á—å? –°–ø—Ä–æ—Å–∏—Ç–µ –æ –∫—É–ª—å—Ç—É—Ä–∞—Ö, —Ä–µ–≥–∏–æ–Ω–∞—Ö –∏–ª–∏ –∞–≥—Ä–æ—Ç–µ—Ö–Ω–∏–∫–µ –ö—ã—Ä–≥—ã–∑—Å—Ç–∞–Ω–∞.",
                        "–ó–¥—Ä–∞–≤—Å—Ç–≤—É–π—Ç–µ! –ó–∞–¥–∞–≤–∞–π—Ç–µ –≤–æ–ø—Ä–æ—Å—ã –ø–æ —Å–µ–ª—å—Å–∫–æ–º—É —Ö–æ–∑—è–π—Å—Ç–≤—É –ö—ã—Ä–≥—ã–∑—Å—Ç–∞–Ω–∞.",
                        "–ê—Å—Å–∞–ª–æ–º—É –∞–ª–µ–π–∫—É–º! –°–ø—Ä–∞—à–∏–≤–∞–π—Ç–µ –æ –º–µ—Å—Ç–Ω—ã—Ö —Å–æ—Ä—Ç–∞—Ö, —É–¥–æ–±—Ä–µ–Ω–∏—è—Ö –∏–ª–∏ –≤—Ä–µ–¥–∏—Ç–µ–ª—è—Ö."
                    ]
                    return random.choice(greetings)
            else:
                crop = crops[0]
                return f"–ß—Ç–æ –∏–º–µ–Ω–Ω–æ –≤–∞—Å –∏–Ω—Ç–µ—Ä–µ—Å—É–µ—Ç –ø–æ –≤—ã—Ä–∞—â–∏–≤–∞–Ω–∏—é {crop} –≤ –ö—ã—Ä–≥—ã–∑—Å—Ç–∞–Ω–µ? –ú–æ–≥—É —Ä–∞—Å—Å–∫–∞–∑–∞—Ç—å –æ –º–µ—Å—Ç–Ω—ã—Ö —Å–æ—Ä—Ç–∞—Ö, —Ä–µ–≥–∏–æ–Ω–∞—Ö –≤—ã—Ä–∞—â–∏–≤–∞–Ω–∏—è, —ç–∫—Å–ø–æ—Ä—Ç–µ –∏–ª–∏ –∞–≥—Ä–æ—Ç–µ—Ö–Ω–∏–∫–µ."
        
        elif intent == Intent.KYRGYZSTAN_SPECIFIC:
            # –£–õ–£–ß–®–ï–ù–ù–ê–Ø –æ–±—Ä–∞–±–æ—Ç–∫–∞ –ø–æ—á–≤–µ–Ω–Ω—ã—Ö –∑–∞–ø—Ä–æ—Å–æ–≤
            if any(word in message_lower for word in ['–ø–æ—á–≤', '–≥—Ä—É–Ω—Ç']) and entities.get('location'):
                location = entities['location']
                region_info = self.kb.kyrgyzstan_regions.get(location, {})
                return region_info.get('soil_details', f"üå± –ü–æ—á–≤—ã {location.capitalize()} –æ–±–ª–∞—Å—Ç–∏:\n{region_info.get('soil', '–ò–Ω—Ñ–æ—Ä–º–∞—Ü–∏—è —É—Ç–æ—á–Ω—è–µ—Ç—Å—è')}")
            
            if location and location in self.kb.kyrgyzstan_regions:
                region_info = self.kb.kyrgyzstan_regions[location]
                return f"üåÑ {location.capitalize()} –æ–±–ª–∞—Å—Ç—å:\n" \
                       f"üå§Ô∏è –ö–ª–∏–º–∞—Ç: {region_info['climate']}\n" \
                       f"üå± –ü–æ—á–≤—ã: {region_info['soil']}\n" \
                       f"üéØ –°–ø–µ—Ü–∏–∞–ª–∏–∑–∞—Ü–∏—è: {region_info['specialization']}\n" \
                       f"üíß –í–æ–¥–Ω—ã–µ —Ä–µ—Å—É—Ä—Å—ã: {region_info['water']}\n" \
                       f"üè™ –†—ã–Ω–∫–∏ —Å–±—ã—Ç–∞: {region_info['markets']}"
            
            # –£–õ–£–ß–®–ï–ù–ù–ê–Ø –æ–±—Ä–∞–±–æ—Ç–∫–∞ –∑–∞–ø—Ä–æ—Å–æ–≤ –æ —Å–æ—Ä—Ç–∞—Ö
            if any(word in message_lower for word in ['—Å–æ—Ä—Ç', '—Å–æ—Ä—Ç–∞', '–º–µ—Å—Ç–Ω—ã–π —Å–æ—Ä—Ç', '–∫–∞–∫–∏–µ —Å–æ—Ä—Ç–∞']):
                if entities.get('crops'):
                    crop = entities['crops'][0]
                    crop_data = self.kb.crop_data.get(crop, {})
                    specific_info = crop_data.get('kyrgyzstan_specific', '–ú–µ—Å—Ç–Ω—ã–µ –∞–¥–∞–ø—Ç–∏—Ä–æ–≤–∞–Ω–Ω—ã–µ —Å–æ—Ä—Ç–∞')
                    return f"üá∞üá¨ –õ—É—á—à–∏–µ —Å–æ—Ä—Ç–∞ {crop} –¥–ª—è –ö—ã—Ä–≥—ã–∑—Å—Ç–∞–Ω–∞:\n{specific_info}"
                else:
                    return "üá∞üá¨ –ú–µ—Å—Ç–Ω—ã–µ —Å–æ—Ä—Ç–∞ —Ä–∞—Å—Ç–µ–Ω–∏–π:\n‚Ä¢ –Ø–±–ª–æ–∫–∏: '–ê–ø–æ—Ä—Ç', '–ê–ª–º–∞-–ê—Ç–∏–Ω—Å–∫–∏–π'\n‚Ä¢ –¢–æ–º–∞—Ç—ã: '–ê–ª–∞-–¢–æ–æ', '–û—à—Å–∫–∏–π —Ä–∞–Ω–Ω–∏–π'\n‚Ä¢ –ö–∞—Ä—Ç–æ—Ñ–µ–ª—å: '–ê–∫-–¢–∞—à', '–°—É—É—Å–∞–º—ã—Ä—Å–∫–∏–π'\n‚Ä¢ –û–≥—É—Ä—Ü—ã: '–ö—ã—Ä–≥—ã–∑—Å–∫–∏–π –∫–æ—Ä–Ω–∏—à–æ–Ω'\n‚Ä¢ –ü—à–µ–Ω–∏—Ü–∞: '–ö—ã—Ä–≥—ã–∑—Å–∫–∞—è 95', '–ê–∫-–ë–∞—Å'"
            
            # –£–õ–£–ß–®–ï–ù–ù–ê–Ø –æ–±—Ä–∞–±–æ—Ç–∫–∞ –ø–æ–¥–¥–µ—Ä–∂–∫–∏ –∏ –∫—Ä–µ–¥–∏—Ç–æ–≤
            if any(word in message_lower for word in ['–ø–æ–¥–¥–µ—Ä–∂–∫–∞', '–≥–æ—Å–ø–æ–¥–¥–µ—Ä–∂–∫–∞', '–≥–æ—Å–ø—Ä–æ–≥—Ä–∞–º–º', '—Å—É–±—Å–∏–¥–∏']):
                return self.kb.general_advice['kyrgyzstan_specific']['–≥–æ—Å–ø–æ–¥–¥–µ—Ä–∂–∫–∞']
            
            if any(word in message_lower for word in ['–∫—Ä–µ–¥–∏—Ç', '–∑–∞–µ–º', '—Ñ–∏–Ω–∞–Ω—Å–∏—Ä–æ–≤–∞–Ω', '–ª—å–≥–æ—Ç–Ω']):
                return "üá∞üá¨ –ö—Ä–µ–¥–∏—Ç—ã –¥–ª—è —Ñ–µ—Ä–º–µ—Ä–æ–≤:\n\n" \
                       "üè¶ **–õ—å–≥–æ—Ç–Ω—ã–µ –ø—Ä–æ–≥—Ä–∞–º–º—ã:**\n" \
                       "‚Ä¢ –ú–∏–Ω—Å–µ–ª—å—Ö–æ–∑: –∫—Ä–µ–¥–∏—Ç—ã –ø–æ–¥ 5-7% –≥–æ–¥–æ–≤—ã—Ö\n" \
                       "‚Ä¢ –ê–≥—Ä–æ—Ñ–æ–Ω–¥: –∑–∞–π–º—ã –Ω–∞ —Ç–µ—Ö–Ω–∏–∫—É –∏ –æ–±–æ—Ä—É–¥–æ–≤–∞–Ω–∏–µ\n" \
                       "‚Ä¢ –ö–æ–º–º–µ—Ä—á–µ—Å–∫–∏–µ –±–∞–Ω–∫–∏: —Å–ø–µ—Ü–∏–∞–ª—å–Ω—ã–µ –∞–≥—Ä–æ–∫—Ä–µ–¥–∏—Ç—ã\n\n" \
                       "üìã **–£—Å–ª–æ–≤–∏—è:**\n" \
                       "‚Ä¢ –°—Ç–∞–∂ —Ñ–µ—Ä–º–µ—Ä—Å–∫–æ–π –¥–µ—è—Ç–µ–ª—å–Ω–æ—Å—Ç–∏ –æ—Ç 2 –ª–µ—Ç\n" \
                       "‚Ä¢ –ó–∞–ª–æ–≥ –∏–º—É—â–µ—Å—Ç–≤–∞ –∏–ª–∏ —É—Ä–æ–∂–∞—è\n" \
                       "‚Ä¢ –ë–∏–∑–Ω–µ—Å-–ø–ª–∞–Ω —Å–µ–ª—å—Ö–æ–∑–ø—Ä–æ–∏–∑–≤–æ–¥—Å—Ç–≤–∞\n\n" \
                       "üí° –û–±—Ä–∞—â–∞–π—Ç–µ—Å—å –≤ –º–µ—Å—Ç–Ω—ã–µ –æ—Ç–¥–µ–ª–µ–Ω–∏—è –ú–∏–Ω—Å–µ–ª—å—Ö–æ–∑–∞!"
            
            if any(word in message_lower for word in ['—ç–∫—Å–ø–æ—Ä—Ç', '–≤—ã–≤–æ–∑', '–ø–æ—Å—Ç–∞–≤–∫']):
                return self.kb.general_advice['kyrgyzstan_specific']['—ç–∫—Å–ø–æ—Ä—Ç']
            
            if any(word in message_lower for word in ['–ø–æ–¥–¥–µ—Ä–∂–∫–∞ —ç–∫—Å–ø–æ—Ä—Ç', '—ç–∫—Å–ø–æ—Ä—Ç—ë—Ä']):
                return self.kb.general_advice['kyrgyzstan_specific']['–ø–æ–¥–¥–µ—Ä–∂–∫–∞_—ç–∫—Å–ø–æ—Ä—Ç–µ—Ä–æ–≤']
            
            if any(word in message_lower for word in ['–ø—Ä–æ–≥—Ä–∞–º–º —Ä–∞–∑–≤–∏—Ç', '—Ä–∞–∑–≤–∏—Ç–∏–µ —Å–µ–ª—å—Å–∫', '—Å–µ–ª—å—Å–∫–∏–µ —Ç–µ—Ä—Ä–∏—Ç–æ—Ä–∏']):
                return self.kb.general_advice['kyrgyzstan_specific']['–ø—Ä–æ–≥—Ä–∞–º–º—ã_—Ä–∞–∑–≤–∏—Ç–∏—è']
            
            return "üá∞üá¨ –ò–Ω—Ñ–æ—Ä–º–∞—Ü–∏—è –ø–æ –ö—ã—Ä–≥—ã–∑—Å—Ç–∞–Ω—É:\n" \
                   "‚Ä¢ –ì–æ—Å–ø—Ä–æ–≥—Ä–∞–º–º—ã –ø–æ–¥–¥–µ—Ä–∂–∫–∏ —Ñ–µ—Ä–º–µ—Ä–æ–≤\n‚Ä¢ –≠–∫—Å–ø–æ—Ä—Ç–Ω—ã–µ –≤–æ–∑–º–æ–∂–Ω–æ—Å—Ç–∏\n‚Ä¢ –ú–µ—Å—Ç–Ω—ã–µ —Å–æ—Ä—Ç–∞ —Ä–∞—Å—Ç–µ–Ω–∏–π\n‚Ä¢ –†–µ–≥–∏–æ–Ω–∞–ª—å–Ω—ã–µ –æ—Å–æ–±–µ–Ω–Ω–æ—Å—Ç–∏\n‚Ä¢ –†—ã–Ω–∫–∏ —Å–±—ã—Ç–∞\n\n–£—Ç–æ—á–Ω–∏—Ç–µ, —á—Ç–æ –∏–º–µ–Ω–Ω–æ –∏–Ω—Ç–µ—Ä–µ—Å—É–µ—Ç!"
        
        elif intent == Intent.WATERING:
            if crops:
                crop = crops[0]
                crop_data = self.kb.crop_data.get(crop, {})
                response = f"üíß –ü–æ–ª–∏–≤ {crop}:\n{crop_data.get('watering', '–†–µ–≥—É–ª—è—Ä–Ω—ã–π –ø–æ–ª–∏–≤ —Å —É—á–µ—Ç–æ–º —Ñ–∞–∑—ã —Ä–æ—Å—Ç–∞')}"
                if crop_data.get('kyrgyzstan_specific'):
                    response += f"\n\nüá∞üá¨ –û—Å–æ–±–µ–Ω–Ω–æ—Å—Ç–∏ –¥–ª—è –ö—ã—Ä–≥—ã–∑—Å—Ç–∞–Ω–∞:\n{crop_data['kyrgyzstan_specific']}"
                return response
            return "–î–ª—è —Ä–µ–∫–æ–º–µ–Ω–¥–∞—Ü–∏–π –ø–æ –ø–æ–ª–∏–≤—É —É–∫–∞–∂–∏—Ç–µ –∫—É–ª—å—Ç—É—Ä—É, –Ω–∞–ø—Ä–∏–º–µ—Ä: '–ø–æ–ª–∏–≤ —Ç–æ–º–∞—Ç–æ–≤ –≤ –ß—É–π—Å–∫–æ–π –æ–±–ª–∞—Å—Ç–∏'"
        
        elif intent == Intent.FERTILIZER:
            if crops:
                crop = crops[0]
                crop_data = self.kb.crop_data.get(crop, {})
                response = f"üå± –£–¥–æ–±—Ä–µ–Ω–∏—è –¥–ª—è {crop}:\n{crop_data.get('fertilizer', '–°–±–∞–ª–∞–Ω—Å–∏—Ä–æ–≤–∞–Ω–Ω—ã–µ –ø–æ–¥–∫–æ—Ä–º–∫–∏')}"
                if crop_data.get('kyrgyzstan_specific'):
                    response += f"\n\nüá∞üá¨ –ú–µ—Å—Ç–Ω—ã–µ —É–¥–æ–±—Ä–µ–Ω–∏—è –ö—ã—Ä–≥—ã–∑—Å—Ç–∞–Ω–∞:\n–ò—Å–ø–æ–ª—å–∑—É–π—Ç–µ –∫—É—Ä–∏–Ω—ã–π –ø–æ–º–µ—Ç, –∫–æ—Ä–æ–≤—è–∫, –∑–æ–ª—É –æ—Ç –º–µ—Å—Ç–Ω—ã—Ö —Ö–æ–∑—è–π—Å—Ç–≤"
                return response
            return "–î–ª—è —Ä–µ–∫–æ–º–µ–Ω–¥–∞—Ü–∏–π –ø–æ —É–¥–æ–±—Ä–µ–Ω–∏—è–º —É–∫–∞–∂–∏—Ç–µ –∫—É–ª—å—Ç—É—Ä—É, –Ω–∞–ø—Ä–∏–º–µ—Ä: '—É–¥–æ–±—Ä–µ–Ω–∏—è –¥–ª—è –∫–∞—Ä—Ç–æ—Ñ–µ–ª—è'"
        
        elif intent == Intent.PEST_CONTROL:
            if pests:
                pest = pests[0]
                pest_advice = self.kb.general_advice['pest_control'].get(pest, "–∫–æ–º–ø–ª–µ–∫—Å–Ω—ã–µ –º–µ—Ä—ã –∑–∞—â–∏—Ç—ã")
                crop_info = f" –Ω–∞ {crops[0]}" if crops else ""
                return f"üêõ –ë–æ—Ä—å–±–∞ —Å {pest}{crop_info} –≤ –ö—ã—Ä–≥—ã–∑—Å—Ç–∞–Ω–µ:\n{pest_advice}"
            elif crops:
                crop = crops[0]
                crop_data = self.kb.crop_data.get(crop, {})
                response = f"üêõ –ë–æ—Ä—å–±–∞ —Å –≤—Ä–µ–¥–∏—Ç–µ–ª—è–º–∏ {crop}:\n{crop_data.get('pests', '–ö–æ–º–ø–ª–µ–∫—Å–Ω—ã–π –ø–æ–¥—Ö–æ–¥')}"
                if crop_data.get('kyrgyzstan_specific'):
                    response += f"\n\nüá∞üá¨ –í –ö—ã—Ä–≥—ã–∑—Å—Ç–∞–Ω–µ: –ò—Å–ø–æ–ª—å–∑—É–π—Ç–µ –º–µ—Å—Ç–Ω—ã–µ —Å—Ä–µ–¥—Å—Ç–≤–∞ - –Ω–∞—Å—Ç–æ–∏ —á–∏—Å—Ç–æ—Ç–µ–ª–∞, —Ç–∞–±–∞–∫–∞, –∑–æ–ª—É"
                return response
            return "–î–ª—è –±–æ—Ä—å–±—ã —Å –≤—Ä–µ–¥–∏—Ç–µ–ª—è–º–∏ —É–∫–∞–∂–∏—Ç–µ –∫—É–ª—å—Ç—É—Ä—É –∏–ª–∏ –∫–æ–Ω–∫—Ä–µ—Ç–Ω–æ–≥–æ –≤—Ä–µ–¥–∏—Ç–µ–ª—è"
        
        elif intent == Intent.DISEASE_HELP:
            if symptoms:
                crop = crops[0] if crops else '—Ä–∞—Å—Ç–µ–Ω–∏–π'
                analysis = self.ml.analyze_symptoms(symptoms)
                if analysis:
                    top_issue = max(analysis.items(), key=lambda x: x[1])[0]
                    treatment = self.kb.general_advice['disease_control'].get(top_issue, "–∫–æ–Ω—Å—É–ª—å—Ç–∞—Ü–∏—è —Å–ø–µ—Ü–∏–∞–ª–∏—Å—Ç–∞")
                    return f"üè• –°–∏–º–ø—Ç–æ–º—ã —É–∫–∞–∑—ã–≤–∞—é—Ç –Ω–∞ {top_issue}.\nüíä –†–µ–∫–æ–º–µ–Ω–¥—É—é: {treatment}\n\nüá∞üá¨ –í –ö—ã—Ä–≥—ã–∑—Å—Ç–∞–Ω–µ –∏—Å–ø–æ–ª—å–∑—É–π—Ç–µ –º–µ—Å—Ç–Ω—ã–µ —É—Å—Ç–æ–π—á–∏–≤—ã–µ —Å–æ—Ä—Ç–∞!"
            
            if crops:
                crop = crops[0]
                crop_data = self.kb.crop_data.get(crop, {})
                response = f"ü¶† –ë–æ–ª–µ–∑–Ω–∏ {crop}:\n{crop_data.get('diseases', '–†–µ–≥—É–ª—è—Ä–Ω—ã–π –æ—Å–º–æ—Ç—Ä –∏ –ø—Ä–æ—Ñ–∏–ª–∞–∫—Ç–∏–∫–∞')}"
                if crop_data.get('kyrgyzstan_specific'):
                    response += f"\n\nüá∞üá¨ –ü—Ä–æ—Ñ–∏–ª–∞–∫—Ç–∏–∫–∞ –≤ –ö—ã—Ä–≥—ã–∑—Å—Ç–∞–Ω–µ:\n–í—ã–±–∏—Ä–∞–π—Ç–µ —Å–æ—Ä—Ç–∞, –∞–¥–∞–ø—Ç–∏—Ä–æ–≤–∞–Ω–Ω—ã–µ –∫ –º–µ—Å—Ç–Ω–æ–º—É –∫–ª–∏–º–∞—Ç—É"
                return response
            return "–û–ø–∏—à–∏—Ç–µ —Å–∏–º–ø—Ç–æ–º—ã –ø–æ–¥—Ä–æ–±–Ω–µ–µ –¥–ª—è —Ç–æ—á–Ω–æ–π –¥–∏–∞–≥–Ω–æ—Å—Ç–∏–∫–∏"
        
        elif intent == Intent.HARVEST_TIPS:
            if crops:
                crop = crops[0]
                crop_data = self.kb.crop_data.get(crop, {})
                response = f"üì¶ –°–±–æ—Ä —É—Ä–æ–∂–∞—è {crop}:\n{crop_data.get('harvest', '–°–±–æ—Ä –ø—Ä–∏ —Ç–µ—Ö–Ω–∏—á–µ—Å–∫–æ–π —Å–ø–µ–ª–æ—Å—Ç–∏')}"
                if crop_data.get('kyrgyzstan_specific'):
                    response += f"\n\nüá∞üá¨ –†—ã–Ω–∫–∏ –ö—ã—Ä–≥—ã–∑—Å—Ç–∞–Ω–∞:\n{crop_data['kyrgyzstan_specific']}"
                return response
            return "–î–ª—è —Å–æ–≤–µ—Ç–æ–≤ –ø–æ —É–±–æ—Ä–∫–µ —É–∫–∞–∂–∏—Ç–µ –∫—É–ª—å—Ç—É—Ä—É"
        
        elif intent == Intent.PLANTING:
            if crops:
                crop = crops[0]
                crop_data = self.kb.crop_data.get(crop, {})
                response = f"üå± –ü–æ—Å–∞–¥–∫–∞ {crop}:\n{crop_data.get('planting', '–°–æ–±–ª—é–¥–µ–Ω–∏–µ —Å—Ä–æ–∫–æ–≤ –∏ —Å—Ö–µ–º—ã –ø–æ—Å–∞–¥–∫–∏')}"
                if crop_data.get('kyrgyzstan_specific'):
                    response += f"\n\nüá∞üá¨ –°—Ä–æ–∫–∏ –ø–æ—Å–∞–¥–∫–∏ –≤ –ö—ã—Ä–≥—ã–∑—Å—Ç–∞–Ω–µ:\n–£—á–∏—Ç—ã–≤–∞–π—Ç–µ —Ä–µ–≥–∏–æ–Ω –∏ –≤—ã—Å–æ—Ç—É –Ω–∞–¥ —É—Ä–æ–≤–Ω–µ–º –º–æ—Ä—è"
                return response
            return "–î–ª—è —Ä–µ–∫–æ–º–µ–Ω–¥–∞—Ü–∏–π –ø–æ –ø–æ—Å–∞–¥–∫–µ —É–∫–∞–∂–∏—Ç–µ –∫—É–ª—å—Ç—É—Ä—É"
        
        elif intent == Intent.PRUNING:
            if crops:
                crop = crops[0]
                crop_data = self.kb.crop_data.get(crop, {})
                return f"‚úÇÔ∏è –û–±—Ä–µ–∑–∫–∞ {crop}:\n{crop_data.get('pruning', '–§–æ—Ä–º–∏—Ä–æ–≤–∞–Ω–∏–µ –∏ —Å–∞–Ω–∏—Ç–∞—Ä–Ω–∞—è –æ–±—Ä–µ–∑–∫–∞')}"
            return "–î–ª—è —Å–æ–≤–µ—Ç–æ–≤ –ø–æ –æ–±—Ä–µ–∑–∫–µ —É–∫–∞–∂–∏—Ç–µ –∫—É–ª—å—Ç—É—Ä—É"
        
        elif intent == Intent.STORAGE:
            if crops:
                crop = crops[0]
                crop_data = self.kb.crop_data.get(crop, {})
                response = f"üì¶ –•—Ä–∞–Ω–µ–Ω–∏–µ {crop}:\n{crop_data.get('storage', '–°–æ–±–ª—é–¥–µ–Ω–∏–µ —Ç–µ–º–ø–µ—Ä–∞—Ç—É—Ä–Ω–æ–≥–æ —Ä–µ–∂–∏–º–∞')}"
                if crop in ['—è–±–ª–æ–∫–∏', '–∫–∞—Ä—Ç–æ—Ñ–µ–ª—å', '–º–æ—Ä–∫–æ–≤—å']:
                    response += f"\n\nüá∞üá¨ –í –ö—ã—Ä–≥—ã–∑—Å—Ç–∞–Ω–µ –∏—Å–ø–æ–ª—å–∑—É—é—Ç: –ø–æ–¥–≤–∞–ª—ã, –ø–æ–≥—Ä–µ–±–∞, –≥–æ—Ä–Ω—ã–µ —Ö—Ä–∞–Ω–∏–ª–∏—â–∞"
                return response
            return "–î–ª—è —Ä–µ–∫–æ–º–µ–Ω–¥–∞—Ü–∏–π –ø–æ —Ö—Ä–∞–Ω–µ–Ω–∏—é —É–∫–∞–∂–∏—Ç–µ –∫—É–ª—å—Ç—É—Ä—É"
        
        elif intent == Intent.COMPANION_PLANTING:
            if crops:
                crop = crops[0]
                companions = self.kb.general_advice['companion_planting'].get(crop, "–ë–∞—Ä—Ö–∞—Ç—Ü—ã, –∫–∞–ª–µ–Ω–¥—É–ª–∞, –Ω–∞—Å—Ç—É—Ä—Ü–∏—è")
                local_tips = self.kb.general_advice['companion_planting'].get(f"{crop}_kyrgyz", "")
                response = f"üåø –°–æ–≤–º–µ—Å—Ç–∏–º—ã–µ —Ä–∞—Å—Ç–µ–Ω–∏—è –¥–ª—è {crop}:\n{companions}"
                if local_tips:
                    response += f"\n\nüá∞üá¨ –ú–µ—Å—Ç–Ω–∞—è –ø—Ä–∞–∫—Ç–∏–∫–∞:\n{local_tips}"
                return response
            return "–î–ª—è —Å–æ–≤–µ—Ç–æ–≤ –ø–æ —Å–æ–≤–º–µ—Å—Ç–∏–º–æ—Å—Ç–∏ —É–∫–∞–∂–∏—Ç–µ –∫—É–ª—å—Ç—É—Ä—É"
        
        elif intent == Intent.SOIL_ADVICE:
            soil_type = entities.get('soil_type')
            if soil_type:
                advice = self.kb.general_advice['soil_improvement'].get(soil_type, "–í–Ω–µ—Å–µ–Ω–∏–µ –æ—Ä–≥–∞–Ω–∏–∫–∏")
                return f"üå± –£–ª—É—á—à–µ–Ω–∏–µ {soil_type} –ø–æ—á–≤—ã –≤ –ö—ã—Ä–≥—ã–∑—Å—Ç–∞–Ω–µ:\n{advice}"
            
            location = entities.get('location')
            if location and location in self.kb.kyrgyzstan_regions:
                region_info = self.kb.kyrgyzstan_regions[location]
                return region_info.get('soil_details', f"üå± –ü–æ—á–≤—ã {location.capitalize()} –æ–±–ª–∞—Å—Ç–∏:\n{region_info.get('soil', '–ò–Ω—Ñ–æ—Ä–º–∞—Ü–∏—è —É—Ç–æ—á–Ω—è–µ—Ç—Å—è')}")
            
            # –î–û–ë–ê–í–ò–ú –æ–±—Ä–∞–±–æ—Ç–∫—É –ø—Ä–æ—Å—Ç–æ–≥–æ –∑–∞–ø—Ä–æ—Å–∞ "–ø–æ—á–≤–∞"
            if '–ø–æ—á–≤' in message_lower:
                return "üå± –ò–Ω—Ñ–æ—Ä–º–∞—Ü–∏—è –æ –ø–æ—á–≤–∞—Ö –ö—ã—Ä–≥—ã–∑—Å—Ç–∞–Ω–∞:\n\n" \
                       "üèîÔ∏è –ü–æ —Ä–µ–≥–∏–æ–Ω–∞–º:\n" \
                       "‚Ä¢ –ß—É–π—Å–∫–∞—è: —Å–µ—Ä–æ–∑–µ–º—ã, –Ω—É–∂–¥–∞—é—Ç—Å—è –≤ –æ—Ä–≥–∞–Ω–∏–∫–µ\n" \
                       "‚Ä¢ –ò—Å—Å—ã–∫-–ö—É–ª—å—Å–∫–∞—è: –∫–∞—à—Ç–∞–Ω–æ–≤—ã–µ, –ø–ª–æ–¥–æ—Ä–æ–¥–Ω—ã–µ\n" \
                       "‚Ä¢ –û—à—Å–∫–∞—è: —Å–µ—Ä–æ–∑–µ–º—ã, —Ç—Ä–µ–±—É—é—Ç –æ—Ä–æ—à–µ–Ω–∏—è\n" \
                       "‚Ä¢ –ù–∞—Ä—ã–Ω—Å–∫–∞—è: –≥–æ—Ä–Ω–æ-—Å—Ç–µ–ø–Ω—ã–µ, –Ω—É–∂–¥–∞—é—Ç—Å—è –≤ —É–¥–æ–±—Ä–µ–Ω–∏—è—Ö\n\n" \
                       "üí° –£—Ç–æ—á–Ω–∏—Ç–µ —Ä–µ–≥–∏–æ–Ω –∏–ª–∏ —Ç–∏–ø –ø–æ—á–≤—ã –¥–ª—è –∫–æ–Ω–∫—Ä–µ—Ç–Ω—ã—Ö —Ä–µ–∫–æ–º–µ–Ω–¥–∞—Ü–∏–π!"
            
            return "–î–ª—è —Å–æ–≤–µ—Ç–æ–≤ –ø–æ –ø–æ—á–≤–µ —É–∫–∞–∂–∏—Ç–µ –µ–µ —Ç–∏–ø –∏–ª–∏ —Ä–µ–≥–∏–æ–Ω –ö—ã—Ä–≥—ã–∑—Å—Ç–∞–Ω–∞"
        
        elif intent == Intent.WEATHER:
            return "üå§Ô∏è –ü–æ–≥–æ–¥–Ω—ã–µ —É—Å–ª–æ–≤–∏—è –ö—ã—Ä–≥—ã–∑—Å—Ç–∞–Ω–∞:\n" \
                   "‚Ä¢ –ß—É–π—Å–∫–∞—è –¥–æ–ª–∏–Ω–∞: –∂–∞—Ä–∫–æ–µ –ª–µ—Ç–æ, —Ö–æ–ª–æ–¥–Ω–∞—è –∑–∏–º–∞\n" \
                   "‚Ä¢ –ò—Å—Å—ã–∫-–ö—É–ª—å: —É–º–µ—Ä–µ–Ω–Ω—ã–π –∫–ª–∏–º–∞—Ç\n" \
                   "‚Ä¢ –Æ–∂–Ω—ã–µ –æ–±–ª–∞—Å—Ç–∏: –∂–∞—Ä–∫–æ, –º–∞–ª–æ –æ—Å–∞–¥–∫–æ–≤\n" \
                   "‚Ä¢ –ì–æ—Ä–Ω—ã–µ —Ä–∞–π–æ–Ω—ã: –ø—Ä–æ—Ö–ª–∞–¥–Ω–æ, –≤–æ–∑–º–æ–∂–Ω—ã –∑–∞–º–æ—Ä–æ–∑–∫–∏ –ª–µ—Ç–æ–º"
        
        else:
            return "–ú–æ–≥—É –ø–æ–º–æ—á—å —Å –≤–æ–ø—Ä–æ—Å–∞–º–∏ –ø–æ —Å–µ–ª—å—Å–∫–æ–º—É —Ö–æ–∑—è–π—Å—Ç–≤—É –ö—ã—Ä–≥—ã–∑—Å—Ç–∞–Ω–∞. –£—Ç–æ—á–Ω–∏—Ç–µ, —á—Ç–æ –∏–º–µ–Ω–Ω–æ –≤–∞—Å –∏–Ω—Ç–µ—Ä–µ—Å—É–µ—Ç."

# –û—Å—Ç–∞–ª—å–Ω–æ–π –∫–æ–¥ –æ—Å—Ç–∞–µ—Ç—Å—è –±–µ–∑ –∏–∑–º–µ–Ω–µ–Ω–∏–π (AdvancedAgroGPTService, AgroGPTApiHandler, run_server)
# ... [–ó–¥–µ—Å—å –¥–æ–ª–∂–µ–Ω –±—ã—Ç—å –æ—Å—Ç–∞–ª—å–Ω–æ–π –∫–æ–¥ –∏–∑ –ø—Ä–µ–¥—ã–¥—É—â–µ–π –≤–µ—Ä—Å–∏–∏] ...

class AdvancedAgroGPTService:
    def __init__(self):
        self.knowledge_base = AdvancedAgroKnowledgeBase()
        self.ml_service = AgroMLService()
        self.context_manager = AgroContextManager()
        self.response_generator = AgroResponseGenerator(self.knowledge_base, self.ml_service)
        self.database = AgroDatabase()
        
        self.usage_stats = {
            'total_requests': 0,
            'intents_count': {},
            'common_crops': {},
            'start_time': datetime.now().isoformat()
        }
        
        logger.info("AgroGPT Service –¥–ª—è –ö—ã—Ä–≥—ã–∑—Å—Ç–∞–Ω–∞ –∏–Ω–∏—Ü–∏–∞–ª–∏–∑–∏—Ä–æ–≤–∞–Ω")
    
    async def process_message(self, user_message: str, session_id: str = None, user_id: str = None) -> Dict[str, Any]:
        """–ê—Å–∏–Ω—Ö—Ä–æ–Ω–Ω–∞—è –æ–±—Ä–∞–±–æ—Ç–∫–∞ —Å–æ–æ–±—â–µ–Ω–∏—è –ø–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª—è"""
        try:
            self.usage_stats['total_requests'] += 1
            
            if session_id is None:
                session_id = "default"
            session_id = str(session_id)
            
            # –ü–æ–ª—É—á–∞–µ–º –∫–æ–Ω—Ç–µ–∫—Å—Ç –î–û –∞–Ω–∞–ª–∏–∑–∞ –∏–Ω—Ç–µ–Ω—Ç–∞
            context = self.context_manager.get_context(session_id)
            
            intent = await self._analyze_intent_advanced(user_message)
            entities = await self._extract_entities_advanced(user_message)
            
            # –ï—Å–ª–∏ —ç—Ç–æ –ø–µ—Ä–≤–æ–µ —Å–æ–æ–±—â–µ–Ω–∏–µ "–ø—Ä–∏–≤–µ—Ç" –∏–ª–∏ –ø–æ–¥–æ–±–Ω–æ–µ, —É—Å—Ç–∞–Ω–∞–≤–ª–∏–≤–∞–µ–º —Å—Ç–∞–¥–∏—é greeting
            if intent == Intent.GENERAL and not any(word in user_message.lower() for word in ['—Ä–µ–≥–∏–æ–Ω', '–∫—É–ª—å—Ç—É—Ä', '—É–¥–æ–±—Ä–µ–Ω–∏', '–ø–æ–ª–∏–≤']):
                if context.get('conversation_stage') != 'active':
                    context['conversation_stage'] = 'greeting'
            
            self._update_context(session_id, intent, entities, context)
            
            response = self.response_generator.generate_response(intent, entities, context, user_message)
            
            self.database.save_message(
                session_id=session_id,
                user_message=user_message,
                bot_response=response,
                intent=intent.value,
                entities=entities
            )
            
            self._update_stats(intent, entities)
            
            safe_context = self._make_context_json_safe(context)
            
            return {
                'response': response,
                'intent': intent.value,
                'entities': entities,
                'context': safe_context,
                'session_id': session_id,
                'timestamp': datetime.now().isoformat()
            }
            
        except Exception as e:
            logger.error(f"–û—à–∏–±–∫–∞ –æ–±—Ä–∞–±–æ—Ç–∫–∏ —Å–æ–æ–±—â–µ–Ω–∏—è: {e}", exc_info=True)
            return {
                'response': "–ö–µ—á–∏—Ä–µ—Å–∏–∑, –∫–∞—Ç–∞ –∫–µ—Ç—Ç–∏. –°—É—Ä–∞–Ω—ã—á, –∫–∞–π—Ä–∞ –∞—Ä–∞–∫–µ—Ç –∫—ã–ª—ã“£—ã–∑.",
                'error': str(e),
                'session_id': session_id
            }
    
    async def _analyze_intent_advanced(self, message: str) -> Intent:
        """–ü—Ä–æ–¥–≤–∏–Ω—É—Ç—ã–π –∞–Ω–∞–ª–∏–∑ –Ω–∞–º–µ—Ä–µ–Ω–∏—è"""
        message_lower = message.lower().strip()
        
        # –£–õ–£–ß–®–ï–ù–ù–û–ï —Ä–∞—Å–ø–æ–∑–Ω–∞–≤–∞–Ω–∏–µ —Ä–µ–≥–∏–æ–Ω–æ–≤ - –¥–∞–∂–µ –ø–æ –∫–æ—Ä–æ—Ç–∫–∏–º –∑–∞–ø—Ä–æ—Å–∞–º
        if any(word in message_lower for word in ['—á—É–π', '–±–∏—à–∫–µ–∫', '—Ç–æ–∫–º–∞–∫', '–∫–∞—Ä–∞ –±–∞–ª—Ç–∞']):
            return Intent.KYRGYZSTAN_SPECIFIC
        
        if any(word in message_lower for word in ['–Ω–∞—Ä—ã–Ω', '–∞—Ç –±–∞—à—ã', '–∫–æ—á–∫–æ—Ä']):
            return Intent.KYRGYZSTAN_SPECIFIC
        
        if any(word in message_lower for word in ['–∏—Å—Å—ã–∫ –∫—É–ª—å', '–∫–∞—Ä–∞–∫–æ–ª', '—á–æ–ª–ø–æ–Ω –∞—Ç–∞', '–±–∞–ª—ã–∫—á—ã']):
            return Intent.KYRGYZSTAN_SPECIFIC
        
        if any(word in message_lower for word in ['–æ—à', '—É–∑–≥–µ–Ω', '–∫–∞—Ä–∞ —Å—É—É']):
            return Intent.KYRGYZSTAN_SPECIFIC
            
        # –£–õ–£–ß–®–ï–ù–ù–û–ï —Ä–∞—Å–ø–æ–∑–Ω–∞–≤–∞–Ω–∏–µ –ø–æ–¥–¥–µ—Ä–∂–∫–∏ –∏ –∫—Ä–µ–¥–∏—Ç–æ–≤
        if any(word in message_lower for word in ['–ø–æ–¥–¥–µ—Ä–∂–∫–∞', '–≥–æ—Å–ø–æ–¥–¥–µ—Ä–∂–∫–∞', '–≥–æ—Å–ø—Ä–æ–≥—Ä–∞–º–º', '–∫—Ä–µ–¥–∏—Ç', '—Å—É–±—Å–∏–¥–∏', '—Ñ–∏–Ω–∞–Ω—Å']):
            return Intent.KYRGYZSTAN_SPECIFIC
        
        # –£–õ–£–ß–®–ï–ù–ù–û–ï —Ä–∞—Å–ø–æ–∑–Ω–∞–≤–∞–Ω–∏–µ —Å–æ—Ä—Ç–æ–≤
        if any(word in message_lower for word in ['—Å–æ—Ä—Ç', '—Å–æ—Ä—Ç–∞', '–º–µ—Å—Ç–Ω—ã–π —Å–æ—Ä—Ç', '–∫–∞–∫–∏–µ —Å–æ—Ä—Ç–∞']):
            return Intent.KYRGYZSTAN_SPECIFIC
        
        # –ö—ã—Ä–≥—ã–∑—Å—Ç–∞–Ω-—Å–ø–µ—Ü–∏—Ñ–∏—á–Ω—ã–µ –∑–∞–ø—Ä–æ—Å—ã
        if any(word in message_lower for word in ['–∫—ã—Ä–≥—ã–∑—Å—Ç–∞–Ω', '–∫—ã—Ä–≥—ã–∑', '–±–∏—à–∫–µ–∫', '–æ—à', '–∏—Å—Å—ã–∫ –∫—É–ª—å', '–∏—Å—Å—ã–∫-–∫—É–ª—å', 
                                                '—á—É–π—Å–∫', '–¥–∂–∞–ª–∞–ª –∞–±–∞–¥', '–¥–∂–∞–ª–∞–ª-–∞–±–∞–¥', '–Ω–∞—Ä—ã–Ω', '—Ç–∞–ª–∞—Å', '–±–∞—Ç–∫–µ–Ω']):
            return Intent.KYRGYZSTAN_SPECIFIC
        
        if any(word in message_lower for word in ['–ø—Ä–∏–≤–µ—Ç', '–∑–¥—Ä–∞–≤—Å—Ç–≤—É–π', 'hello', 'hi', '–¥–æ–±—Ä—ã–π', '—Å–∞–ª–∞–º', '–∞—Å—Å–∞–ª–æ–º']):
            return Intent.GENERAL
        
        if any(word in message_lower for word in ['–ø–æ–ª–∏–≤', '–ø–æ–ª–∏–≤–∞—Ç—å', '–≤–æ–¥–∞', '–æ—Ä–æ—à–µ–Ω–∏–µ', '–∞—Ä—ã–∫']):
            return Intent.WATERING
        
        if any(word in message_lower for word in ['—É–¥–æ–±—Ä–µ–Ω–∏', '–ø–æ–¥–∫–æ—Ä–º–∫', '–ø–∏—Ç–∞–Ω–∏–µ', '–∞–∑–æ—Ç', '—Ñ–æ—Å—Ñ–æ—Ä', '–∫–∞–ª–∏–π']):
            return Intent.FERTILIZER
        
        if any(word in message_lower for word in ['–≤—Ä–µ–¥–∏—Ç–µ–ª', '–Ω–∞—Å–µ–∫–æ–º—ã–µ', '–∂—É–∫', '—Ç–ª—è', '–∫–ª–µ—â', '–≥—É—Å–µ–Ω–∏—Ü']):
            return Intent.PEST_CONTROL
        
        if any(word in message_lower for word in ['–±–æ–ª–µ–∑–Ω', '–∑–∞–±–æ–ª–µ–ª', '–ø–æ–∂–µ–ª—Ç–µ–ª', '—Å–æ—Ö–Ω–µ—Ç', '–ø—è—Ç–Ω–∞', '–≥–Ω–∏–ª—å']):
            return Intent.DISEASE_HELP
        
        if any(word in message_lower for word in ['–ø–æ—Å–∞–¥–∫', '—Å–∞–∂–∞—Ç—å', '—Å–µ—è—Ç—å', '—Ä–∞—Å—Å–∞–¥']):
            return Intent.PLANTING
        
        if any(word in message_lower for word in ['–æ–±—Ä–µ–∑–∫', '–ø–∞—Å—ã–Ω–∫–æ–≤–∞–Ω', '—Ñ–æ—Ä–º–∏—Ä–æ–≤–∞–Ω']):
            return Intent.PRUNING
        
        if any(word in message_lower for word in ['—Ö—Ä–∞–Ω–µ–Ω', '—Å–æ—Ö—Ä–∞–Ω', '—Ö—Ä–∞–Ω–∏—Ç—å']):
            return Intent.STORAGE
        
        if any(word in message_lower for word in ['—É—Ä–æ–∂–∞–π', '—Å–±–æ—Ä', '—Å–æ–∑—Ä–µ–≤', '—É–±–æ—Ä–∫']):
            return Intent.HARVEST_TIPS
        
        if any(word in message_lower for word in ['—Å–æ–≤–º–µ—Å—Ç', '—Å–æ—Å–µ–¥', '—Ä—è–¥–æ–º —Å']):
            return Intent.COMPANION_PLANTING
        
        if any(word in message_lower for word in ['–ø–æ—á–≤', '–≥—Ä—É–Ω—Ç', '–∑–µ–º–ª', '–∫–∏—Å–ª–æ—Ç–Ω–æ—Å—Ç—å']):
            return Intent.SOIL_ADVICE
        
        if any(word in message_lower for word in ['–ø–æ–≥–æ–¥', '—Ç–µ–º–ø–µ—Ä–∞—Ç—É—Ä', '–∑–∞–º–æ—Ä–æ–∑–∫']):
            return Intent.WEATHER
        
        return Intent.GENERAL
    
    async def _extract_entities_advanced(self, message: str) -> Dict[str, Any]:
        """–ü—Ä–æ–¥–≤–∏–Ω—É—Ç–æ–µ –∏–∑–≤–ª–µ—á–µ–Ω–∏–µ —Å—É—â–Ω–æ—Å—Ç–µ–π —Å —É–ª—É—á—à–µ–Ω–Ω–æ–π –æ–±—Ä–∞–±–æ—Ç–∫–æ–π"""
        try:
            entities = {
                'crops': [],
                'symptoms': [],
                'season': None,
                'location': None,
                'soil_type': None,
                'pests': []
            }
            
            if not message or not isinstance(message, str):
                return entities
                
            message_lower = message.lower()
            
            # –†–µ–≥–∏–æ–Ω—ã –ö—ã—Ä–≥—ã–∑—Å—Ç–∞–Ω–∞
            kyrgyz_regions = {
                '—á—É–π—Å–∫–∞—è': ['—á—É–π—Å–∫', '—á—É–π—Å–∫–æ–π', '–±–∏—à–∫–µ–∫', '—Ç–æ–∫–º–∞–∫', '–∫–∞—Ä–∞ –±–∞–ª—Ç–∞', '—á—É–π'],
                '–∏—Å—Å—ã–∫-–∫—É–ª—å—Å–∫–∞—è': ['–∏—Å—Å—ã–∫ –∫—É–ª—å', '–∏—Å—Å—ã–∫–∫—É–ª—å', '–∫–∞—Ä–∞–∫–æ–ª', '—á–æ–ª–ø–æ–Ω –∞—Ç–∞', '–±–∞–ª—ã–∫—á—ã'],
                '–æ—à—Å–∫–∞—è': ['–æ—à—Å–∫', '–æ—à—Å–∫–æ–π', '–æ—à', '—É–∑–≥–µ–Ω', '–∫–∞—Ä–∞ —Å—É—É'],
                '–¥–∂–∞–ª–∞–ª-–∞–±–∞–¥—Å–∫–∞—è': ['–¥–∂–∞–ª–∞–ª –∞–±–∞–¥', '–¥–∂–∞–ª–∞–ª–∞–±–∞–¥', '–º–∞–π–ª—É—É —Å—É—É', '–∫–æ–∫ –∂–∞–Ω–≥–∞–∫'],
                '–Ω–∞—Ä—ã–Ω—Å–∫–∞—è': ['–Ω–∞—Ä—ã–Ω—Å–∫', '–Ω–∞—Ä—ã–Ω—Å–∫–æ–π', '–Ω–∞—Ä—ã–Ω', '–∞—Ç –±–∞—à—ã', '–∫–æ—á–∫–æ—Ä'],
                '—Ç–∞–ª–∞—Å—Å–∫–∞—è': ['—Ç–∞–ª–∞—Å—Å–∫', '—Ç–∞–ª–∞—Å—Å–∫–æ–π', '—Ç–∞–ª–∞—Å', '–∫–∞—Ä–∞ –±—É—É—Ä–∞', '–º–∞–Ω–∞—Å'],
                '–±–∞—Ç–∫–µ–Ω—Å–∫–∞—è': ['–±–∞—Ç–∫–µ–Ω—Å–∫', '–±–∞—Ç–∫–µ–Ω—Å–∫–æ–π', '–±–∞—Ç–∫–µ–Ω', '–∏—Å—Ñ–∞–Ω–∞', '–∫—ã–∑—ã–ª –∫–∏—è']
            }
            
            for region_name, patterns in kyrgyz_regions.items():
                if any(pattern in message_lower for pattern in patterns):
                    entities['location'] = region_name
                    break
            
            crop_patterns = {
                '—Ç–æ–º–∞—Ç': ['—Ç–æ–º–∞—Ç', '–ø–æ–º–∏–¥–æ—Ä', '–ø–æ–º–∏–¥–æ—Ä—ã', '—Ç–æ–º–∞—Ç—ã'],
                '–∫–∞—Ä—Ç–æ—Ñ–µ–ª—å': ['–∫–∞—Ä—Ç–æ—Ñ–µ–ª', '–∫–∞—Ä—Ç–æ—à–∫', '–∫–∞—Ä—Ç–æ—Ñ–µ–ª–∏', '–∫–∞—Ä—Ç–æ—Ñ–µ–ª—è'],
                '–æ–≥—É—Ä–µ—Ü': ['–æ–≥—É—Ä–µ—Ü', '–æ–≥—É—Ä—Ü', '–æ–≥—É—Ä—Ü—ã', '–æ–≥—É—Ä—Ü–æ–≤'],
                '–∫–∞–ø—É—Å—Ç–∞': ['–∫–∞–ø—É—Å—Ç', '–∫–∞–ø—É—Å—Ç—É', '–∫–∞–ø—É—Å—Ç–æ–π'],
                '–º–æ—Ä–∫–æ–≤—å': ['–º–æ—Ä–∫–æ–≤', '–º–æ—Ä–∫–æ–≤—å', '–º–æ—Ä–∫–æ–≤–∏', '–º–æ—Ä–∫–æ–≤–∫—É'],
                '–ø–µ—Ä–µ—Ü': ['–ø–µ—Ä–µ—Ü', '–ø–µ—Ä—Ü–∞', '–ø–µ—Ä—Ü—ã'],
                '–±–∞–∫–ª–∞–∂–∞–Ω': ['–±–∞–∫–ª–∞–∂–∞–Ω', '–±–∞–∫–ª–∞–∂–∞–Ω—ã', '–±–∞–∫–ª–∞–∂–∞–Ω–æ–≤', '—Å–∏–Ω–µ–Ω—å–∫–∏–µ'],
                '–ª—É–∫': ['–ª—É–∫', '–ª—É–∫–∞', '–ª—É–∫–æ–º'],
                '—á–µ—Å–Ω–æ–∫': ['—á–µ—Å–Ω–æ–∫', '—á–µ—Å–Ω–æ–∫–∞', '—á–µ—Å–Ω–æ–∫'],
                '—Ä–µ–¥–∏—Å': ['—Ä–µ–¥–∏—Å', '—Ä–µ–¥–∏—Å–∫–∞', '—Ä–µ–¥–∏—Å–∫–∏'],
                '–∫–ª—É–±–Ω–∏–∫–∞': ['–∫–ª—É–±–Ω–∏–∫', '–∑–µ–º–ª—è–Ω–∏–∫', '–≤–∏–∫—Ç–æ—Ä–∏'],
                '–º–∞–ª–∏–Ω–∞': ['–º–∞–ª–∏–Ω', '–º–∞–ª–∏–Ω—ã', '–º–∞–ª–∏–Ω—É'],
                '—Å–º–æ—Ä–æ–¥–∏–Ω–∞': ['—Å–º–æ—Ä–æ–¥–∏–Ω', '—Å–º–æ—Ä–æ–¥–∏–Ω–∞', '—Å–º–æ—Ä–æ–¥–∏–Ω—ã'],
                '–≤–∏–Ω–æ–≥—Ä–∞–¥': ['–≤–∏–Ω–æ–≥—Ä–∞–¥', '–≤–∏–Ω–æ–≥—Ä–∞–¥–∞', '–≤–∏–Ω–æ–≥—Ä–∞–¥–æ–º'],
                '—è–±–ª–æ–Ω—è': ['—è–±–ª–æ–Ω', '—è–±–ª–æ–Ω–∏', '—è–±–ª–æ–∫', '–∞–ø–æ—Ä—Ç'],
                '–≥—Ä—É—à–∞': ['–≥—Ä—É—à', '–≥—Ä—É—à–∏', '–≥—Ä—É—à—É'],
                '–∞–±—Ä–∏–∫–æ—Å': ['–∞–±—Ä–∏–∫–æ—Å', '–∞–±—Ä–∏–∫–æ—Å—ã', '—É—Ä—é–∫'],
                '–ø—à–µ–Ω–∏—Ü–∞': ['–ø—à–µ–Ω–∏—Ü', '–ø—à–µ–Ω–∏—Ü—ã', '–ø—à–µ–Ω–∏—Ü—É']
            }
            
            for crop_name, patterns in crop_patterns.items():
                if any(pattern in message_lower for pattern in patterns):
                    if crop_name not in entities['crops']:
                        entities['crops'].append(crop_name)
            
            pest_patterns = {
                '—Ç–ª—è': ['—Ç–ª—è', '—Ç–ª–∏', '—Ç–ª—é'],
                '–∫–ª–µ—â': ['–∫–ª–µ—â', '–∫–ª–µ—â–∏', '–ø–∞—É—Ç–∏–Ω–Ω—ã–π'],
                '–≥—É—Å–µ–Ω–∏—Ü—ã': ['–≥—É—Å–µ–Ω–∏—Ü', '–≥—É—Å–µ–Ω–∏—Ü—ã', '–ª–∏—Å—Ç–æ–≤–µ—Ä—Ç–∫'],
                '—Å–ª–∏–∑–Ω–∏': ['—Å–ª–∏–∑–Ω', '—Å–ª–∏–∑–Ω—è–∫', '—Å–ª–∏–∑–Ω–µ–π'],
                '–º—É—Ö–∏': ['–º—É—Ö', '–º—É—Ö–∏', '–º–æ—Ä–∫–æ–≤–Ω–∞—è –º—É—Ö', '–ª—É–∫–æ–≤–∞—è –º—É—Ö'],
                '–∫–æ–ª–æ—Ä–∞–¥—Å–∫–∏–π –∂—É–∫': ['–∫–æ–ª–æ—Ä–∞–¥—Å–∫', '–∫–æ–ª–æ—Ä–∞–¥—Å–∫–∏–π', '–∫–æ–ª–æ—Ä–∞–¥—ã']
            }
            
            for pest_name, patterns in pest_patterns.items():
                if any(pattern in message_lower for pattern in patterns):
                    entities['pests'].append(pest_name)
            
            symptom_patterns = [
                '–∂–µ–ª—Ç–µ', '—Å–æ—Ö–Ω–µ—Ç', '–ø—è—Ç–Ω', '–≥–Ω–∏–ª', '—É–≤—è–¥–∞', '–ø–ª–µ—Å–µ–Ω—å', 
                '–º–æ–∑–∞–∏–∫', '–¥–µ—Ñ–æ—Ä–º–∞—Ü', '—Å–∫—Ä—É—á–∏–≤–∞–Ω', '–±–ª–µ–¥–Ω', '–ø–æ–¥–¥–µ—Ä–∂–∫–∞',
                '—ç–∫—Å–ø–æ—Ä—Ç', '—Å–æ—Ä—Ç', '–º–µ—Å—Ç–Ω—ã–π', '–∞–¥–∞–ø—Ç–∏—Ä–æ–≤–∞–Ω', '–∫—Ä–µ–¥–∏—Ç'
            ]
            
            for symptom in symptom_patterns:
                if symptom in message_lower:
                    entities['symptoms'].append(symptom)
            
            soil_types = {
                '–≥–ª–∏–Ω–∏—Å—Ç': '–≥–ª–∏–Ω–∏—Å—Ç–∞—è',
                '–ø–µ—Å—á': '–ø–µ—Å—á–∞–Ω–∞—è', 
                '–∫–∏—Å–ª': '–∫–∏—Å–ª–∞—è',
                '—â–µ–ª–æ—á–Ω': '—â–µ–ª–æ—á–Ω–∞—è'
            }
            
            for soil_pattern, soil_name in soil_types.items():
                if soil_pattern in message_lower:
                    entities['soil_type'] = soil_name
                    break
            
            season_patterns = {
                '–≤–µ—Å–Ω–∞': ['–≤–µ—Å–Ω', '–≤–µ—Å–µ–Ω–Ω', '–∞–ø—Ä–µ–ª', '–º–∞–π'],
                '–ª–µ—Ç–æ': ['–ª–µ—Ç', '–ª–µ—Ç–Ω', '–∏—é–Ω', '–∏—é–ª', '–∞–≤–≥—É—Å—Ç'],
                '–æ—Å–µ–Ω—å': ['–æ—Å–µ–Ω', '—Å–µ–Ω—Ç—è–±—Ä', '–æ–∫—Ç—è–±—Ä', '–Ω–æ—è–±—Ä'],
                '–∑–∏–º–∞': ['–∑–∏–º', '–∑–∏–º–Ω', '–¥–µ–∫–∞–±—Ä', '—è–Ω–≤–∞—Ä', '—Ñ–µ–≤—Ä–∞–ª']
            }
            
            for season_name, patterns in season_patterns.items():
                if any(pattern in message_lower for pattern in patterns):
                    entities['season'] = season_name
                    break
            
            return entities
            
        except Exception as e:
            logger.error(f"Error extracting entities: {e}")
            return {
                'crops': [], 'symptoms': [], 'season': None, 
                'location': None, 'soil_type': None, 'pests': []
            }
    
    def _make_context_json_safe(self, context: Dict) -> Dict:
        """–ü—Ä–µ–æ–±—Ä–∞–∑—É–µ—Ç –∫–æ–Ω—Ç–µ–∫—Å—Ç –≤ JSON-–±–µ–∑–æ–ø–∞—Å–Ω—ã–π —Ñ–æ—Ä–º–∞—Ç"""
        safe_context = {}
        for key, value in context.items():
            if isinstance(value, datetime):
                safe_context[key] = value.isoformat()
            elif isinstance(value, (list, dict)):
                safe_context[key] = self._make_json_safe(value)
            else:
                safe_context[key] = value
        return safe_context
    
    def _make_json_safe(self, obj):
        """–†–µ–∫—É—Ä—Å–∏–≤–Ω–æ –ø—Ä–µ–æ–±—Ä–∞–∑—É–µ—Ç –æ–±—ä–µ–∫—Ç—ã –≤ JSON-–±–µ–∑–æ–ø–∞—Å–Ω—ã–µ"""
        if isinstance(obj, dict):
            return {k: self._make_json_safe(v) for k, v in obj.items()}
        elif isinstance(obj, list):
            return [self._make_json_safe(item) for item in obj]
        elif isinstance(obj, datetime):
            return obj.isoformat()
        elif isinstance(obj, timedelta):
            return str(obj)
        else:
            return obj
    
    def _update_context(self, session_id: str, intent: Intent, entities: Dict, context: Dict):
        """–û–±–Ω–æ–≤–ª–µ–Ω–∏–µ –∫–æ–Ω—Ç–µ–∫—Å—Ç–∞ —Ä–∞–∑–≥–æ–≤–æ—Ä–∞"""
        updates = {'last_intent': intent.value}
        
        if entities['crops']:
            updates['crops'] = entities['crops']
        
        self.context_manager.update_context(session_id, updates)
    
    def _update_stats(self, intent: Intent, entities: Dict):
        """–û–±–Ω–æ–≤–ª–µ–Ω–∏–µ —Å—Ç–∞—Ç–∏—Å—Ç–∏–∫–∏"""
        intent_str = intent.value
        self.usage_stats['intents_count'][intent_str] = self.usage_stats['intents_count'].get(intent_str, 0) + 1
        
        for crop in entities['crops']:
            self.usage_stats['common_crops'][crop] = self.usage_stats['common_crops'].get(crop, 0) + 1
    
    def get_usage_statistics(self) -> Dict:
        return self.usage_stats
    
    def get_session_context(self, session_id: str) -> Dict:
        context = self.context_manager.get_context(session_id)
        return self._make_context_json_safe(context)

def validate_chat_request(data: Dict) -> tuple[bool, str]:
    """–í–∞–ª–∏–¥–∞—Ü–∏—è –≤—Ö–æ–¥—è—â–∏—Ö –¥–∞–Ω–Ω—ã—Ö –¥–ª—è —á–∞—Ç–∞"""
    if not data:
        return False, "Empty request data"
    
    if 'message' not in data:
        return False, "Missing 'message' field"
    
    message = data['message']
    if not isinstance(message, str):
        return False, "Message must be a string"
    
    if len(message.strip()) == 0:
        return False, "Message cannot be empty"
    
    if len(message) > 1000:
        return False, "Message too long (max 1000 characters)"
    
    return True, "Valid"

# HTTP Handler –∫–ª–∞—Å—Å
class AgroGPTApiHandler(BaseHTTPRequestHandler):
    def __init__(self, *args, **kwargs):
        self.agro_service = AdvancedAgroGPTService()
        self.executor = ThreadPoolExecutor(max_workers=4)
        super().__init__(*args, **kwargs)
    
    def _run_async(self, coro):
        """–ó–∞–ø—É—Å–∫ –∞—Å–∏–Ω—Ö—Ä–æ–Ω–Ω–æ–π —Ñ—É–Ω–∫—Ü–∏–∏ –≤ –æ—Ç–¥–µ–ª—å–Ω–æ–º event loop"""
        loop = asyncio.new_event_loop()
        asyncio.set_event_loop(loop)
        try:
            return loop.run_until_complete(coro)
        finally:
            loop.close()
    
    def do_OPTIONS(self):
        self.send_response(200)
        self._set_cors_headers()
        self.end_headers()
    
    def _set_cors_headers(self):
        self.send_header('Access-Control-Allow-Origin', '*')
        self.send_header('Access-Control-Allow-Methods', 'GET, POST, OPTIONS')
        self.send_header('Access-Control-Allow-Headers', 'Content-Type')
        self.send_header('Access-Control-Max-Age', '86400')
    
    def do_GET(self):
        parsed_path = urlparse.urlparse(self.path)
        path = parsed_path.path
        
        try:
            if path == '/api/health' or path == '/health':
                self._handle_health()
            elif path == '/api/stats' or path == '/stats':
                self._handle_stats()
            elif path.startswith('/api/context/') or path.startswith('/context/'):
                session_id = path.split('/')[-1]
                self._handle_context(session_id)
            else:
                self._handle_404()
        except Exception as e:
            self._handle_error(f"Internal server error: {str(e)}")
    
    def do_POST(self):
        content_length = int(self.headers.get('Content-Length', 0))
        post_data = self.rfile.read(content_length)
        
        try:
            data = json.loads(post_data.decode('utf-8'))
            
            if self.path == '/api/chat' or self.path == '/chat':
                self._handle_chat(data)
            elif self.path == '/api/analyze-plant' or self.path == '/analyze-plant':
                self._handle_analyze_plant(data)
            elif self.path == '/api/predict-yield' or self.path == '/predict-yield':
                self._handle_predict_yield(data)
            else:
                self._handle_404()
        except json.JSONDecodeError:
            self._handle_error("Invalid JSON")
        except Exception as e:
            self._handle_error(f"Internal server error: {str(e)}")
    
    def _handle_health(self):
        response = {
            "status": "healthy", 
            "timestamp": datetime.now().isoformat(),
            "service": "AgroGPT –ö–´–†–ì–´–ó–°–¢–ê–ù API",
            "version": "10.0.0",
            "message": "‚úÖ –ü–æ–ª–Ω–æ—Å—Ç—å—é –∏—Å–ø—Ä–∞–≤–ª–µ–Ω–Ω–∞—è –≤–µ—Ä—Å–∏—è –¥–ª—è –ö—ã—Ä–≥—ã–∑—Å—Ç–∞–Ω–∞ —Ä–∞–±–æ—Ç–∞–µ—Ç!"
        }
        self._send_json_response(200, response)
    
    def _handle_stats(self):
        stats = self.agro_service.get_usage_statistics()
        self._send_json_response(200, stats)
    
    def _handle_context(self, session_id):
        context = self.agro_service.get_session_context(session_id)
        self._send_json_response(200, context)
    
    def _handle_chat(self, data):
        """–£–ª—É—á—à–µ–Ω–Ω—ã–π –æ–±—Ä–∞–±–æ—Ç—á–∏–∫ —á–∞—Ç–∞ —Å –≤–∞–ª–∏–¥–∞—Ü–∏–µ–π"""
        is_valid, error_message = validate_chat_request(data)
        if not is_valid:
            return self._send_json_response(400, {"error": error_message})
        
        try:
            session_id = data.get('session_id', 'default')
            if isinstance(session_id, list):
                session_id = session_id[0] if session_id else "default"
            
            result = self._run_async(
                self.agro_service.process_message(
                    user_message=data['message'].strip(),
                    session_id=str(session_id),
                    user_id=data.get('user_id')
                )
            )
            self._send_json_response(200, result)
        except Exception as e:
            logger.error(f"Chat processing error: {e}")
            self._handle_error(f"Chat processing error: {str(e)}")
    
    def _handle_analyze_plant(self, data):
        response = {
            "is_healthy": True,
            "disease_name": None,
            "confidence": 0.95,
            "recommendations": ["–†–∞—Å—Ç–µ–Ω–∏–µ –≤—ã–≥–ª—è–¥–∏—Ç –∑–¥–æ—Ä–æ–≤—ã–º", "–ü—Ä–æ–¥–æ–ª–∂–∞–π—Ç–µ —Ç–µ–∫—É—â–∏–π —É—Ö–æ–¥"]
        }
        self._send_json_response(200, response)
    
    def _handle_predict_yield(self, data):
        response = {
            "predicted_yield": 1500,
            "confidence": 0.85,
            "suggestions": ["–û–ø—Ç–∏–º–∏–∑–∏—Ä—É–π—Ç–µ –ø–æ–ª–∏–≤", "–í–Ω–µ—Å–∏—Ç–µ –∫–∞–ª–∏–π–Ω—ã–µ —É–¥–æ–±—Ä–µ–Ω–∏—è"]
        }
        self._send_json_response(200, response)
    
    def _handle_404(self):
        self._send_json_response(404, {"error": "Endpoint not found", "path": self.path})
    
    def _handle_error(self, message):
        self._send_json_response(400, {"error": message})
    
    def _send_json_response(self, status_code: int, data: Dict):
        self.send_response(status_code)
        self.send_header('Content-type', 'application/json; charset=utf-8')
        self._set_cors_headers()
        self.end_headers()
        
        try:
            response_json = json.dumps(data, ensure_ascii=False, indent=2, default=self._json_serializer)
            self.wfile.write(response_json.encode('utf-8'))
        except Exception as e:
            logger.error(f"JSON serialization error: {e}")
            error_response = {"error": "JSON serialization failed"}
            self.wfile.write(json.dumps(error_response).encode('utf-8'))
    
    def _json_serializer(self, obj):
        """–ö–∞—Å—Ç–æ–º–Ω—ã–π —Å–µ—Ä–∏–∞–ª–∏–∑–∞—Ç–æ—Ä –¥–ª—è JSON"""
        if isinstance(obj, (datetime, timedelta)):
            return str(obj)
        raise TypeError(f"Object of type {type(obj)} is not JSON serializable")
    
    def log_message(self, format, *args):
        logger.info(f"{self.address_string()} - {format % args}")

def run_server(port=8000, host='0.0.0.0', debug=False):
    """–ó–∞–ø—É—Å–∫ HTTP —Å–µ—Ä–≤–µ—Ä–∞ —Å —É–ª—É—á—à–µ–Ω–Ω–æ–π –∫–æ–Ω—Ñ–∏–≥—É—Ä–∞—Ü–∏–µ–π"""
    if debug:
        logging.getLogger().setLevel(logging.DEBUG)
    
    server = HTTPServer((host, port), AgroGPTApiHandler)
    
    print("üéØ " + "="*60)
    print("üöÄ AgroGPT –ö–´–†–ì–´–ó–°–¢–ê–ù Server –∑–∞–ø—É—â–µ–Ω!")
    print("üéØ " + "="*60)
    print(f"üì° –°–µ—Ä–≤–µ—Ä –¥–æ—Å—Ç—É–ø–µ–Ω –ø–æ: http://{host}:{port}")
    print(f"üîß –†–µ–∂–∏–º –æ—Ç–ª–∞–¥–∫–∏: {'–í–ö–õ' if debug else '–í–´–ö–õ'}")
    print("üá∞üá¨ –ü–û–õ–ù–û–°–¢–¨–Æ –ò–°–ü–†–ê–í–õ–ï–ù–ù–ê–Ø –í–ï–†–°–ò–Ø!")
    print("üå± –ü–æ–¥–¥–µ—Ä–∂–∏–≤–∞–µ–º—ã–µ –∫—É–ª—å—Ç—É—Ä—ã: —Ç–æ–º–∞—Ç—ã, –æ–≥—É—Ä—Ü—ã, –∫–∞—Ä—Ç–æ—Ñ–µ–ª—å, —è–±–ª–æ–∫–∏, –≤–∏–Ω–æ–≥—Ä–∞–¥, –ø—à–µ–Ω–∏—Ü–∞ –∏ –¥—Ä.")
    print("üèîÔ∏è  –†–µ–≥–∏–æ–Ω—ã: –ß—É–π—Å–∫–∞—è, –ò—Å—Å—ã–∫-–ö—É–ª—å—Å–∫–∞—è, –û—à—Å–∫–∞—è, –î–∂–∞–ª–∞–ª-–ê–±–∞–¥—Å–∫–∞—è, –ù–∞—Ä—ã–Ω—Å–∫–∞—è, –¢–∞–ª–∞—Å—Å–∫–∞—è, –ë–∞—Ç–∫–µ–Ω—Å–∫–∞—è")
    print("üéØ " + "="*60)
    print("üí° –ü—Ä–∏–º–µ—Ä—ã –∑–∞–ø—Ä–æ—Å–æ–≤ –¥–ª—è –ö—ã—Ä–≥—ã–∑—Å—Ç–∞–Ω–∞:")
    print("   '–ø–æ–ª–∏–≤ —Ç–æ–º–∞—Ç–æ–≤ –≤ –ß—É–π—Å–∫–æ–π –æ–±–ª–∞—Å—Ç–∏'")
    print("   '–≥–æ—Å–ø–æ–¥–¥–µ—Ä–∂–∫–∞ —Ñ–µ—Ä–º–µ—Ä–æ–≤'")
    print("   '—ç–∫—Å–ø–æ—Ä—Ç —è–±–ª–æ–∫ –≤ –ö–∞–∑–∞—Ö—Å—Ç–∞–Ω'")
    print("   '–ª—É—á—à–∏–µ —Å–æ—Ä—Ç–∞ –∫–∞—Ä—Ç–æ—Ñ–µ–ª—è –¥–ª—è –ù–∞—Ä—ã–Ω–∞'")
    print("   '—Ä—ã–Ω–∫–∏ —Å–±—ã—Ç–∞ –≤ –û—à—Å–∫–æ–π –æ–±–ª–∞—Å—Ç–∏'")
    print("   '–ø–æ—á–≤—ã –ò—Å—Å—ã–∫-–ö—É–ª—å—Å–∫–æ–π –æ–±–ª–∞—Å—Ç–∏'")
    print("   '–∫—Ä–µ–¥–∏—Ç—ã –¥–ª—è —Ñ–µ—Ä–º–µ—Ä–æ–≤'")
    print("üéØ " + "="*60)
    
    try:
        print(f"üîÑ –°–µ—Ä–≤–µ—Ä –∑–∞–ø—É—â–µ–Ω –≤ {datetime.now().strftime('%Y-%m-%d %H:%M:%S')}")
        server.serve_forever()
    except KeyboardInterrupt:
        print(f"\nüõë –°–µ—Ä–≤–µ—Ä –æ—Å—Ç–∞–Ω–æ–≤–ª–µ–Ω –≤ {datetime.now().strftime('%Y-%m-%d %H:%M:%S')}")
        server.shutdown()
    except Exception as e:
        print(f"‚ùå –û—à–∏–±–∫–∞ —Å–µ—Ä–≤–µ—Ä–∞: {e}")
        logger.error(f"Server error: {e}")

if __name__ == "__main__":
    import sys
    debug_mode = '--debug' in sys.argv
    run_server(debug=debug_mode)
    
agro_gpt_service = AdvancedAgroGPTService()